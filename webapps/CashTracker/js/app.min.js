function toggleFilterList(e){$(e).parents(".filter-entry-list-wrapper").find(".filter-entry-list").toggleClass("visible")}window.Modernizr=function(e,t,n){function o(e){y.cssText=e}function a(e,t){return o(k.join(e+";")+(t||""))}function i(e,t){return typeof e===t}function r(e,t){return!!~(""+e).indexOf(t)}function s(e,t){for(var o in e){var a=e[o];if(!r(a,"-")&&y[a]!==n)return"pfx"==t?a:!0}return!1}function c(e,t,o){for(var a in e){var r=t[e[a]];if(r!==n)return o===!1?e[a]:i(r,"function")?r.bind(o||t):r}return!1}function l(e,t,n){var o=e.charAt(0).toUpperCase()+e.slice(1),a=(e+" "+T.join(o+" ")+o).split(" ");return i(t,"string")||i(t,"undefined")?s(a,t):(a=(e+" "+S.join(o+" ")+o).split(" "),c(a,t,n))}function d(){h.input=function(n){for(var o=0,a=n.length;a>o;o++)D[n[o]]=!!(n[o]in w);return D.list&&(D.list=!(!t.createElement("datalist")||!e.HTMLDataListElement)),D}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),h.inputtypes=function(e){for(var o,a,i,r=0,s=e.length;s>r;r++)w.setAttribute("type",a=e[r]),o="text"!==w.type,o&&(w.value=$,w.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(a)&&w.style.WebkitAppearance!==n?(g.appendChild(w),i=t.defaultView,o=i.getComputedStyle&&"textfield"!==i.getComputedStyle(w,null).WebkitAppearance&&0!==w.offsetHeight,g.removeChild(w)):/^(search|tel)$/.test(a)||(o=/^(url|email)$/.test(a)?w.checkValidity&&w.checkValidity()===!1:w.value!=$)),E[e[r]]=!!o;return E}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var u,p,f="2.7.2",h={},m=!0,g=t.documentElement,v="modernizr",b=t.createElement(v),y=b.style,w=t.createElement("input"),$=":)",x={}.toString,k=" -webkit- -moz- -o- -ms- ".split(" "),A="Webkit Moz O ms",T=A.split(" "),S=A.toLowerCase().split(" "),_={svg:"http://www.w3.org/2000/svg"},C={},E={},D={},N=[],M=N.slice,O=function(e,n,o,a){var i,r,s,c,l=t.createElement("div"),d=t.body,u=d||t.createElement("body");if(parseInt(o,10))for(;o--;)s=t.createElement("div"),s.id=a?a[o]:v+(o+1),l.appendChild(s);return i=["&#173;",'<style id="s',v,'">',e,"</style>"].join(""),l.id=v,(d?l:u).innerHTML+=i,u.appendChild(l),d||(u.style.background="",u.style.overflow="hidden",c=g.style.overflow,g.style.overflow="hidden",g.appendChild(u)),r=n(l,e),d?l.parentNode.removeChild(l):(u.parentNode.removeChild(u),g.style.overflow=c),!!r},P=function(){function e(e,a){a=a||t.createElement(o[e]||"div"),e="on"+e;var r=e in a;return r||(a.setAttribute||(a=t.createElement("div")),a.setAttribute&&a.removeAttribute&&(a.setAttribute(e,""),r=i(a[e],"function"),i(a[e],"undefined")||(a[e]=n),a.removeAttribute(e))),a=null,r}var o={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return e}(),j={}.hasOwnProperty;p=i(j,"undefined")||i(j.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(e,t){return j.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=M.call(arguments,1),o=function(){if(this instanceof o){var a=function(){};a.prototype=t.prototype;var i=new a,r=t.apply(i,n.concat(M.call(arguments)));return Object(r)===r?r:i}return t.apply(e,n.concat(M.call(arguments)))};return o}),C.flexbox=function(){return l("flexWrap")},C.canvas=function(){var e=t.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},C.canvastext=function(){return!(!h.canvas||!i(t.createElement("canvas").getContext("2d").fillText,"function"))},C.webgl=function(){return!!e.WebGLRenderingContext},C.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:O(["@media (",k.join("touch-enabled),("),v,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=9===e.offsetTop}),n},C.geolocation=function(){return"geolocation"in navigator},C.postmessage=function(){return!!e.postMessage},C.websqldatabase=function(){return!!e.openDatabase},C.indexedDB=function(){return!!l("indexedDB",e)},C.hashchange=function(){return P("hashchange",e)&&(t.documentMode===n||t.documentMode>7)},C.history=function(){return!(!e.history||!history.pushState)},C.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},C.websockets=function(){return"WebSocket"in e||"MozWebSocket"in e},C.rgba=function(){return o("background-color:rgba(150,255,150,.5)"),r(y.backgroundColor,"rgba")},C.hsla=function(){return o("background-color:hsla(120,40%,100%,.5)"),r(y.backgroundColor,"rgba")||r(y.backgroundColor,"hsla")},C.multiplebgs=function(){return o("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(y.background)},C.backgroundsize=function(){return l("backgroundSize")},C.borderimage=function(){return l("borderImage")},C.borderradius=function(){return l("borderRadius")},C.boxshadow=function(){return l("boxShadow")},C.textshadow=function(){return""===t.createElement("div").style.textShadow},C.opacity=function(){return a("opacity:.55"),/^0.55$/.test(y.opacity)},C.cssanimations=function(){return l("animationName")},C.csscolumns=function(){return l("columnCount")},C.cssgradients=function(){var e="background-image:",t="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return o((e+"-webkit- ".split(" ").join(t+e)+k.join(n+e)).slice(0,-e.length)),r(y.backgroundImage,"gradient")},C.cssreflections=function(){return l("boxReflect")},C.csstransforms=function(){return!!l("transform")},C.csstransforms3d=function(){var e=!!l("perspective");return e&&"webkitPerspective"in g.style&&O("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t){e=9===t.offsetLeft&&3===t.offsetHeight}),e},C.csstransitions=function(){return l("transition")},C.fontface=function(){var e;return O('@font-face {font-family:"font";src:url("https://")}',function(n,o){var a=t.getElementById("smodernizr"),i=a.sheet||a.styleSheet,r=i?i.cssRules&&i.cssRules[0]?i.cssRules[0].cssText:i.cssText||"":"";e=/src/i.test(r)&&0===r.indexOf(o.split(" ")[0])}),e},C.generatedcontent=function(){var e;return O(["#",v,"{font:0/0 a}#",v,':after{content:"',$,'";visibility:hidden;font:3px/1 a}'].join(""),function(t){e=t.offsetHeight>=3}),e},C.video=function(){var e=t.createElement("video"),n=!1;try{(n=!!e.canPlayType)&&(n=new Boolean(n),n.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(o){}return n},C.audio=function(){var e=t.createElement("audio"),n=!1;try{(n=!!e.canPlayType)&&(n=new Boolean(n),n.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),n.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),n.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(o){}return n},C.localstorage=function(){try{return localStorage.setItem(v,v),localStorage.removeItem(v),!0}catch(e){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(v,v),sessionStorage.removeItem(v),!0}catch(e){return!1}},C.webworkers=function(){return!!e.Worker},C.applicationcache=function(){return!!e.applicationCache},C.svg=function(){return!!t.createElementNS&&!!t.createElementNS(_.svg,"svg").createSVGRect},C.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==_.svg},C.smil=function(){return!!t.createElementNS&&/SVGAnimate/.test(x.call(t.createElementNS(_.svg,"animate")))},C.svgclippaths=function(){return!!t.createElementNS&&/SVGClipPath/.test(x.call(t.createElementNS(_.svg,"clipPath")))};for(var F in C)p(C,F)&&(u=F.toLowerCase(),h[u]=C[F](),N.push((h[u]?"":"no-")+u));return h.input||d(),h.addTest=function(e,t){if("object"==typeof e)for(var o in e)p(e,o)&&h.addTest(o,e[o]);else{if(e=e.toLowerCase(),h[e]!==n)return h;t="function"==typeof t?t():t,"undefined"!=typeof m&&m&&(g.className+=" "+(t?"":"no-")+e),h[e]=t}return h},o(""),b=w=null,function(e,t){function n(e,t){var n=e.createElement("p"),o=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",o.insertBefore(n.lastChild,o.firstChild)}function o(){var e=b.elements;return"string"==typeof e?e.split(" "):e}function a(e){var t=v[e[m]];return t||(t={},g++,e[m]=g,v[g]=t),t}function i(e,n,o){if(n||(n=t),d)return n.createElement(e);o||(o=a(n));var i;return i=o.cache[e]?o.cache[e].cloneNode():h.test(e)?(o.cache[e]=o.createElem(e)).cloneNode():o.createElem(e),!i.canHaveChildren||f.test(e)||i.tagUrn?i:o.frag.appendChild(i)}function r(e,n){if(e||(e=t),d)return e.createDocumentFragment();n=n||a(e);for(var i=n.frag.cloneNode(),r=0,s=o(),c=s.length;c>r;r++)i.createElement(s[r]);return i}function s(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return b.shivMethods?i(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+o().join().replace(/[\w\-]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(b,t.frag)}function c(e){e||(e=t);var o=a(e);return!b.shivCSS||l||o.hasCSS||(o.hasCSS=!!n(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),d||s(e,o),e}var l,d,u="3.7.0",p=e.html5||{},f=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,h=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,m="_html5shiv",g=0,v={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",l="hidden"in e,d=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return"undefined"==typeof e.cloneNode||"undefined"==typeof e.createDocumentFragment||"undefined"==typeof e.createElement}()}catch(n){l=!0,d=!0}}();var b={elements:p.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:u,shivCSS:p.shivCSS!==!1,supportsUnknownElements:d,shivMethods:p.shivMethods!==!1,type:"default",shivDocument:c,createElement:i,createDocumentFragment:r};e.html5=b,c(t)}(this,t),h._version=f,h._prefixes=k,h._domPrefixes=S,h._cssomPrefixes=T,h.hasEvent=P,h.testProp=function(e){return s([e])},h.testAllProps=l,h.testStyles=O,h.prefixed=function(e,t,n){return t?l(e,t,n):l(e,"pfx")},g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(m?" js "+N.join(" "):""),h}(this,this.document),function(e,t,n){function o(e){return"[object Function]"==g.call(e)}function a(e){return"string"==typeof e}function i(){}function r(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function s(){var e=v.shift();b=1,e?e.t?h(function(){("c"==e.t?p.injectCss:p.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),s()):b=0}function c(e,n,o,a,i,c,l){function d(t){if(!f&&r(u.readyState)&&(y.r=f=1,!b&&s(),u.onload=u.onreadystatechange=null,t)){"img"!=e&&h(function(){$.removeChild(u)},50);for(var o in S[n])S[n].hasOwnProperty(o)&&S[n][o].onload()}}var l=l||p.errorTimeout,u=t.createElement(e),f=0,g=0,y={t:o,s:n,e:i,a:c,x:l};1===S[n]&&(g=1,S[n]=[]),"object"==e?u.data=n:(u.src=n,u.type=e),u.width=u.height="0",u.onerror=u.onload=u.onreadystatechange=function(){d.call(this,g)},v.splice(a,0,y),"img"!=e&&(g||2===S[n]?($.insertBefore(u,w?null:m),h(d,l)):S[n].push(u))}function l(e,t,n,o,i){return b=0,t=t||"j",a(e)?c("c"==t?k:x,e,t,this.i++,n,o,i):(v.splice(this.i++,0,e),1==v.length&&s()),this}function d(){var e=p;return e.loader={load:l,i:0},e}var u,p,f=t.documentElement,h=e.setTimeout,m=t.getElementsByTagName("script")[0],g={}.toString,v=[],b=0,y="MozAppearance"in f.style,w=y&&!!t.createRange().compareNode,$=w?f:m.parentNode,f=e.opera&&"[object Opera]"==g.call(e.opera),f=!!t.attachEvent&&!f,x=y?"object":f?"script":"img",k=f?"script":x,A=Array.isArray||function(e){return"[object Array]"==g.call(e)},T=[],S={},_={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};p=function(e){function t(e){var t,n,o,e=e.split("!"),a=T.length,i=e.pop(),r=e.length,i={url:i,origUrl:i,prefixes:e};for(n=0;r>n;n++)o=e[n].split("="),(t=_[o.shift()])&&(i=t(i,o));for(n=0;a>n;n++)i=T[n](i);return i}function r(e,a,i,r,s){var c=t(e),l=c.autoCallback;c.url.split(".").pop().split("?").shift(),c.bypass||(a&&(a=o(a)?a:a[e]||a[r]||a[e.split("/").pop().split("?")[0]]),c.instead?c.instead(e,a,i,r,s):(S[c.url]?c.noexec=!0:S[c.url]=1,i.load(c.url,c.forceCSS||!c.forceJS&&"css"==c.url.split(".").pop().split("?").shift()?"c":n,c.noexec,c.attrs,c.timeout),(o(a)||o(l))&&i.load(function(){d(),a&&a(c.origUrl,s,r),l&&l(c.origUrl,s,r),S[c.url]=2})))}function s(e,t){function n(e,n){if(e){if(a(e))n||(u=function(){var e=[].slice.call(arguments);p.apply(this,e),f()}),r(e,u,t,0,l);else if(Object(e)===e)for(c in s=function(){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}(),e)e.hasOwnProperty(c)&&(!n&&!--s&&(o(u)?u=function(){var e=[].slice.call(arguments);p.apply(this,e),f()}:u[c]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),f()}}(p[c])),r(e[c],u,t,c,l))}else!n&&f()}var s,c,l=!!e.test,d=e.load||e.both,u=e.callback||i,p=u,f=e.complete||i;n(l?e.yep:e.nope,!!d),d&&n(d)}var c,l,u=this.yepnope.loader;if(a(e))r(e,0,u,0);else if(A(e))for(c=0;c<e.length;c++)l=e[c],a(l)?r(l,0,u,0):A(l)?p(l):Object(l)===l&&s(l,u);else Object(e)===e&&s(e,u)},p.addPrefix=function(e,t){_[e]=t},p.addFilter=function(e){T.push(e)},p.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",u=function(){t.removeEventListener("DOMContentLoaded",u,0),t.readyState="complete"},0)),e.yepnope=d(),e.yepnope.executeStack=s,e.yepnope.injectJs=function(e,n,o,a,c,l){var d,u,f=t.createElement("script"),a=a||p.errorTimeout;f.src=e;for(u in o)f.setAttribute(u,o[u]);n=l?s:n||i,f.onreadystatechange=f.onload=function(){!d&&r(f.readyState)&&(d=1,n(),f.onload=f.onreadystatechange=null)},h(function(){d||(d=1,n(1))},a),c?f.onload():m.parentNode.insertBefore(f,m)},e.yepnope.injectCss=function(e,n,o,a,r,c){var l,a=t.createElement("link"),n=c?s:n||i;a.href=e,a.rel="stylesheet",a.type="text/css";for(l in o)a.setAttribute(l,o[l]);r||(m.parentNode.insertBefore(a,m),h(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};var nb={APP_NAME:location.hostname,LANG_ID:"RUS",debug:!0,strings:{yes:"Да",no:"Нет",ok:"Ok",cancel:"Отмена",select:"Выбрать",dialog_select_value:"Вы не сделали выбор"},form:{},dialog:{},utils:{},xhr:{}},nbApp={};nb.ajax=function(e){var t=$.ajax(e);return t.error(function(e){return console.error("nb.ajax : error",e),400==e.status&&nb.dialog.error({title:nb.getText("error_xhr","Ошибка запроса"),message:e.responseText}),e}),t},nb.getText=function(e,t,n){return nbStrings[n||this.LANG_ID][e]?nbStrings[n||this.LANG_ID][e]:void 0!==t?t:e},nb.openXML=function(){window.location.href=window.location+"&onlyxml"},nb.form.setValues=function(e){function t(){if(s){$("[name="+r+"]",i).remove();var e=[];n.each(function(t,n){$('<input type="hidden" name="'+r+'" value="'+n.value+'" />').appendTo(i),e.push("<li>"+$(n).data("text")+"</li>")}),$("#"+r+"tbl").html(e.join(""))}else{var t=$("[name="+r+"]",i);0===t.length&&(t=$('<input type="hidden" name="'+r+'" />'),$(i).append(t[0])),t.val(n[0].value),$("#"+r+"tbl").html("<li>"+n.attr("data-text")+"</li>")}return!0}var n,o=$(e).parents("[role=dialog]"),a=$('[data-role="nb-dialog"]',o),i=nb.utils.getForm(a[0].dialogOptions.targetForm),r=a[0].dialogOptions.fieldName,s=!1,c="";return i?(n=$('[data-type="select"]:checked',a[0]),n.length>0?(s=n.length>1,s||(c=""),t(n)):(a[0].dialogOptions.effect&&(o.stop(),o.effect(a[0].dialogOptions.effect,{times:2},300)),0===$(".js-no-selected-value",o[0]).length&&!function(){var e=$('<div class="alert alert-danger js-no-selected-value" style="border-radius:2px;top:55%;left:4%;right:4%;position:absolute;">'+a[0].dialogOptions.errorMessage+"</div>");a.after(e),setTimeout(function(){e.fadeOut({always:function(){e.remove()}})},800)}(),!1)):(nb.dialog.warn({title:"Error",message:"Error nb.form.setValues > form is not found: "+i}),!1)},nb.utils.clearField=function(e){$("[name="+e+"]").val(""),$("#"+e+"tbl").html("")},nb.utils.getForm=function(e){return null===e||void 0===e?e:"string"==typeof e&&document[e]&&"FORM"===document[e].nodeName?document[e]:e.form||e},nb.utils.blockUI=function(){var e=$("#nb-block-ui");0===e.length&&(e=$('<div id="nb-block-ui" style="background:rgba(0,0,0,0.1);position:fixed;top:0;left:0;bottom:0;right:0;z-index:999;"/>'),e.appendTo("body")),e.css("display","block")},nb.utils.unblockUI=function(){$("#nb-block-ui").css("display","none")},nb.utils.notify=function(e){var t=$("#nb-notify-wrapper");t.length||(t=$('<div id="nb-notify-wrapper" class="nb-notify"></div>').appendTo("body"));var n=$('<div class="nb-notify-entry-'+(e.type||"info")+'">'+e.message+"</div>").appendTo(t);return{show:function(){return n.css("display","block"),this},hide:function(){return n.css("display","none"),this},set:function(e){for(var t in e)"text"===t?n.text(e[t]):"type"===t&&n.attr("class","nb-notify-entry-"+e[t]);return this},remove:function(e,t){if(null!==n)if(e&&e>0){setTimeout(function(){n.remove(),n=null,t&&t()},e)}else n.remove(),n=null,t&&t()}}},$(document).ready(function(){nb.LANG_ID=$.cookie("lang")||"RUS",$(":checkbox").bind("click",function(){var e=$(this);if(!e.data("toggle"))return!0;var t=this.name||e.data("toggle"),n=$("[name="+t+"]:checkbox:visible");n.each(e.is(":checked")?function(){this.checked=!0}:function(){this.checked=!1})})}),nb.dialog={_props:{title:nb.APP_NAME},info:function(e){return e.className="dialog-info",e.width=e.width||"360",e.height=e.height||"210",e.buttons=e.buttons||{Ok:function(){$(this).dialog("close")}},this.show(e)},warn:function(e){return e.className="dialog-warn",e.width=e.width||"360",e.height=e.height||"210",e.buttons=e.buttons||{Ok:function(){$(this).dialog("close")}},this.show(e)},error:function(e){return e.className="dialog-error",e.width=e.width||"360",e.height=e.height||"210",e.buttons=e.buttons||{Ok:function(){$(this).dialog("close")}},this.show(e)},execute:function(e){var t=$(e).parents("[role=dialog]"),n=$("[data-role=nb-dialog]",t);n[0].dialogOptions.onExecute(arguments)},show:function(e){var t;if(e.id=e.id||null,e.title=e.title||this._props.title,e.href=e.href||null,e.className=e.className||"",e.message=e.message||null,e.filter=e.filter,e.dialogFilterListItem=e.dialogFilterListItem||"li",e.buttons=e.buttons||null,e.dialogClass="nb-dialog "+(e.dialogClass?e.dialogClass:""),e.errorMessage=e.errorMessage||nb.strings.dialog_select_value,e.onLoad=e.onLoad||null,e.onExecute=e.onExecute||function(){nb.form.setValues(t,null)&&t.dialog("close")},e.autoOpen=!0,e.modal=e.modal===!1?!1:!0,e.width=e.width||"360",e.position=e.position||"center",null===e.id&&e.href){if(e.id="dlg_"+e.href.replace(/[^a-z0-9]/gi,""),t=$("#"+e.id),t[0])return t.dialog("isOpen")===!0?void 0:void t.dialog("open")}else if(null!==e.id&&(t=$("#"+e.id),t[0]))return t.dialog("isOpen")===!0?void 0:void t.dialog("open");null===e.id&&(e.close=e.close||function(){t.dialog("destroy"),t.remove()});var n;return n=$(e.href?'<div data-role="nb-dialog" id="'+e.id+'" class="nb-dialog-container '+e.className+'"><div class="loading-state"></div></div>':e.id?'<div data-role="nb-dialog" id="'+e.id+'" class="nb-dialog-container '+e.className+'">'+e.message+"</div>":'<div data-role="nb-dialog" class="nb-dialog-container '+e.className+'">'+e.message+"</div>"),e.href?(t=n.load(e.href,"",function(t,o,a){if("error"===o)n.html('<div class="alert alert-danger">'+o+"</div>"),console.log("nb.dialog : load callback",a);else{try{null!==e.onLoad&&e.onLoad(t,o,a)}catch(i){console.log("nb.dialog",i)}try{e.filter!==!1&&new nb.dialog.Filter(n,e.dialogFilterListItem,13)}catch(i){console.log("nb.dialog",i)}}}).dialog(e),t.on("click","a",function(e){e.preventDefault(),n.load(this.href)}),t.on("change","select",function(e){e.preventDefault(),n.load(this.href)})):t=n.dialog(e),t[0].dialogOptions=e,nb.debug===!0&&console.log("nb.dialog: ",e),t}},nb.dialog.Filter=function(e,t,n,o){function a(){r=$(p,f[0]);var e=$(".toggle-response",f[0]).length>0;r.length<c&&!e||(0===$(".dialog-filter",h).length&&f.before('<div class="dialog-filter"></div>'),$(".dialog-filter",h).append('<label>Фильтр: <label><input type="text" name="keyword" data-role="search" />'),s=$(".dialog-filter input[data-role=search]",h),s.on("keyup",function(e){try{if(clearTimeout(u),13===e.keyCode)return}catch(t){console.log(t)}u=setTimeout(function(){r=$(p,f[0]),i(e.target.value)},d)}))}function i(e){try{if(e.length>=l){var t=0;r.attr("style","");var n=new RegExp(e,"gim");r.each(function(e,o){n.test(o.textContent)||0===$(":checked",o).length&&($(o).attr("style","display:none;"),t++)}),r.length>t?s.attr("title","By keyword ["+e+"] filtered "+(r.length-t)):s.attr("title","filter_no_results")}else r.attr("style",""),s.attr("title","")}catch(o){console.log(o)}}var r,s=null,c=n||13,l=o||2,d=300,u=null,p=t||".item",f=e,h=f.parents("[role=dialog]");a()},nb.windowOpen=function(e,t,n){var o,a=800,i=600,r=(window.innerHeight-i)/2,s=(window.innerWidth-a)/2;0>r&&(r=0),0>s&&(s=0),o="top="+r+",left="+s,o+=",height="+i+",width="+a+",resizable=yes,scrollbars=yes,status=no";var c="window-"+(t||e.hashCode()),l=window.open("",c,o);if(("about:blank"===l.document.URL||""===l.document.URL)&&(l=window.open(e,c,o),n&&n.onclose))var d=setInterval(function(){l.closed&&(clearInterval(d),n.onclose())},1e3);l.focus()},nb.xhr.deleteDocument=function(e,t){return nb.debug===!0&&console.log("nb.xhr.deleteDocument: ",e,t),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"delete",ck:e,typedel:t}})},nb.xhr.restoreDeletedDocument=function(e){return nb.debug===!0&&console.log("nb.xhr.restoreDeletedDocument: ",e),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"undelete",ck:e}})},nb.xhr.addDocumentToFavorite=function(e,t){return nb.debug===!0&&console.log("nb.xhr.addDocumentToFavorite: ",e,t),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"service",operation:"add_to_favourites",doctype:t,key:e}})},nb.xhr.removeDocumentFromFavorite=function(e,t){return nb.debug===!0&&console.log("nb.xhr.removeDocumentFromFavorite: ",e,t),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"service",operation:"remove_from_favourites",doctype:t,key:e}})},nb.xhr.markDocumentAsRead=function(e,t){return nb.debug===!0&&console.log("nb.xhr.markDocumentAsRead: ",e,t),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"service",operation:"mark_as_read",id:"mark_as_read",doctype:t,key:e}})},nb.xhr.getUsersWichRead=function(e,t){return nb.debug===!0&&console.log("nb.xhr.getUsersWichRead: ",e,t),nb.ajax({type:"GET",datatype:"XML",url:"Provider",data:{type:"service",operation:"users_which_read",id:"users_which_read",doctype:t,key:e}})},nb.xhr.saveDocument=function(e){e=e||{};var t=nb.utils.notify({message:nb.getText("wait_while_document_save","Пожалуйста ждите... идет сохранение документа"),type:"process"}).show(),n={cache:!1,type:"POST",datatype:"XML",url:"Provider",data:e.data||$("form").serialize(),beforeSend:function(){nb.utils.blockUI(),$(".required, [required]","form").removeClass("required").removeAttr("required")},success:function(n){var o=nb.utils.parseMessageToJson(n),a=o.message[0];if("ok"===o.status)t.set({text:nb.getText("document_saved","Документ сохранен"),type:"success"}),a.length>0?nb.dialog.info({message:a,close:function(){(o.redirect||e.redirect)&&(window.location.href=o.redirect||e.redirect)}}):(o.redirect||e.redirect)&&setTimeout(function(){window.location.href=o.redirect||e.redirect},300);else if(0===a.indexOf("require:")){var r=a.substr("require:".length).split(",");for(i=0;i<r.length;i++)$("#"+r[i]+"tbl").addClass("required"),$("[name="+r[i]+"]").attr("required","required").addClass("required");t.set({text:nb.getText("required_field_not_filled","Не заполнены обязательные поля"),type:"error"})}else t.set({text:a,type:"error"})},error:function(){t.set({text:nb.getText("error_xhr","Ошибка при выполнении запроса"),type:"error"})}},o=nb.ajax(n);return o.always(function(){nb.utils.unblockUI(),t.remove(2e3)}),o},nb.utils.parseMessageToJson=function(e){var t={};return $(e).find("response").each(function(){t.status=$(this).attr("status"),t.redirect=$("redirect",this).text(),t.message=[],$(this).find("message").each(function(){t.message.push($(this).text())})}),t},nb.xhr.chooseFilter=function(e,t,n){return nb.debug===!0&&console.log("nb.xhr.chooseFilter: ",e,t,n),nb.ajax({type:"GET",datatype:"XML",url:"Provider?param=filter_mode~on&param=filtered_column~"+t+"&param=key_word~"+n,cache:!1,data:{type:"service",operation:"tune_session",element:"page",id:e}})},nb.xhr.resetFilter=function(e){return nb.debug===!0&&console.log("nb.xhr.resetFilter: ",e),nb.ajax({type:"POST",datatype:"XML",url:"Provider",cache:!1,data:{type:"service",operation:"tune_session",element:"page",id:e,param:"filter_mode~reset_all"}})},nb.xhr.resetCurrentFilter=function(e,t){return nb.debug===!0&&console.log("nb.xhr.resetCurrentFilter: ",e,t),nb.ajax({type:"GET",datatype:"XML",url:"Provider?param=filter_mode~on&param=filtered_column~"+t,cache:!1,data:{type:"service",operation:"tune_session",element:"page",id:e}})};var nbStrings={RUS:{},KAZ:{},ENG:{},CHN:{}};nbStrings.RUS={yes:"Да",no:"Нет",ok:"Ok",cancel:"Отмена",select:"Выбрать",dialog_select_value:"Вы не сделали выбор"},nb.xhr.sendSortRequest=function(e,t,n){return nb.debug===!0&&console.log("nb.xhr.sendSortRequest: ",e,t,n),nb.ajax({type:"POST",datatype:"XML",url:"Provider?param=sorting_mode~on&param=sorting_column~"+t.toLowerCase()+"&param=sorting_direction~"+n.toLowerCase(),data:{type:"service",operation:"tune_session",element:"page",id:e}})};var nbApp={isTouch:!1,needDocsAction:["delete_document"],allActionsNeedDocsEnabled:!1};nbApp.init=function(){var e=new MobileDetect(window.navigator.userAgent);e.phone()?this.uiMakeTouch("phone"):e.tablet()?this.uiMakeTouch("tablet"):window.innerWidth<=800&&this.uiMakeTouch("phone"),this.initScrollSpyActionBar(),this.initScrollSpySide(),this.initUI(),this.uiToggleAvailableActions(),$("body").removeClass("no_transition"),$("#main-load").css("display","none")},nbApp.uiWindowResize=function(){window.innerWidth<=800?this.uiMakeTouch("phone"):$("body").removeClass("phone")},nbApp.uiMakeTouch=function(e){$("body").addClass(e)},nbApp.uiToggleNavApp=function(){$("body").toggleClass("nav-app-open")},nbApp.uiToggleNavWorkspace=function(){$("body").toggleClass("nav-ws-open")},nbApp.uiHideOpenedNav=function(){$("body").removeClass("nav-app-open nav-ws-open")},nbApp.toggleSearchForm=function(){$("body").toggleClass("search-open")},nbApp.uiToggleAvailableActions=function(){var e=$("[name=docid]:checked").length>0;if(!nbApp.allActionsNeedDocsEnabled||!e)for(var t=nbApp.needDocsAction.length,n=0;t>n;n++)e?($(".action_"+nbApp.needDocsAction[n]).removeClass("disabled").removeAttr("disabled"),nbApp.allActionsNeedDocsEnabled=!0):($(".action_"+nbApp.needDocsAction[n]).addClass("disabled").attr("disabled","disabled"),nbApp.allActionsNeedDocsEnabled=!1)},nbApp.parseXmlMessageToJson=function(e){return nb.utils.parseMessageToJson(e)},$(document).ready(function(){nbApp.init(),$("#main-load").css({"background-color":"rgba(255,255,255,.5)"}),window.onunload=window.onbeforeunload=function(){$("#main-load").show()}}),nbApp.attachInitFileUpload=function(e){if($("#progress").css("display","none"),"undefined"!=typeof $.fn.fileupload){var t=$(e);0!==t.length&&t.fileupload({url:"Uploader",dataType:"xml",send:function(){$("#progress").css("display","block")},done:function(e,t){var n=$("#template-rtfcontent-entry").children().clone(),o=nbApp.parseXmlMessageToJson(t.result);if("undefined"==typeof o.message||0===o.message.length)return $(".progress-bar",$("#progress").css("display","none")[0]).css("width","0%"),void alert("file upload error: empty response message");var a=o.message[0].toString(),i=o.message[1].toString(),r=o.message[3].toString(),s="Provider?type=getattach&formsesid="+r;s+="&field=rtfcontent&id=rtfcontent&file="+a,n.appendTo("#attach-files"),n.append('<input type="hidden" name="filename" value="'+a+'"/>'),n.append('<input type="hidden" name="fileid" value="'+r+'"/>'),n.append('<input type="hidden" name="filehash" value="'+i+'"/>'),$("a.rtf-file",n).attr({href:s,target:"_blank"}).text(a),$("[data-click=add_comment]",n).on("click",function(){nbApp.attachAddComment(this,i)}),$("[data-click=remove]",n).on("click",function(){nbApp.attachRemove(this,r,a,i,!0)}),setTimeout(function(){$(".progress-bar",$("#progress").css("display","none")[0]).css("width","0%")},1e3)},progressall:function(e,t){var n=parseInt(t.loaded/t.total*100,10);$("#progress .progress-bar").css("width",n+"%").text(n+"%")},fail:function(){$(".progress-bar",$("#progress").css("display","none")[0]).css("width","0%"),alert("file upload fail")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}},nbApp.attachPreview=function(e){var t=$(e).parents(".rtf-entry"),n=t.find("a.rtf-file").append('<i class="rtf-loading"></i>');$('<img class="attach-preview" style="display:none;">').attr("src",n.attr("href")).on("load",function(){$(this).show(),$("i.rtf-loading",n).remove()}).on("error",function(){alert("load error"),$("i.rtf-loading",n).remove(),$(this).remove()}).appendTo(t),$(e).hide()},nbApp.attachAddComment=function(e,t){var n=$(e).parents(".rtf-entry"),o=nb.dialog.show({message:$('<div><textarea rows="6"></textarea></div>').html(),title:"Коментарий",buttons:{Ok:{text:"Ok",click:function(){var a=$("textarea",o).val();return 0===a.length?!1:($("#frm").append('<input type="hidden" name="comment'+t+'" value="'+a+'">'),n.find("a.rtf-file").after($('<span class="rtf-comment">').html(a)),$(e).hide(),void o.dialog("close"))}},Cancel:{text:"Oтмена",click:function(){o.dialog("close")}}}})},nbApp.attachRemove=function(e,t,n,o,a){a===!0?$(e).parents(".rtf-entry").remove():$(e).parents(".rtf-entry").addClass("to-delete"),$("#"+o).remove(),$("#frm").append('<input type="hidden" name="deletertfcontentsesid" value="'+t+'" />'),$("#frm").append('<input type="hidden" name="deletertfcontentname" value="'+n+'" />'),$("#frm").append('<input type="hidden" name="deletertfcontentfield" value="rtfcontent" />')},nbApp.saveDoc=function(e){var t=nb.xhr.saveDocument({redirect:e});return t},nbApp.closeDoc=function(e){"undefined"!=typeof e&&0!==e.length?window.location.href=e:window.history.back()},nbApp.clearFormField=function(e){nb.utils.clearField(e)},nbApp.markRead=function(e,t){setTimeout(function(){nb.xhr.markDocumentAsRead(t,e).then(function(){nb.utils.notify({message:nb.getText("document_mark_as_read")}).show().remove(1500)})},2e3)},nbApp.usersWhichReadInTable=function(e,t,n){nb.xhr.getUsersWichRead(n,t).then(function(e){var t=$("#userswhichreadtbl"),n=["<tr><td>","1","</td><td>","3","</td></tr>"];$(e).find("entry").each(function(){var e=$(this).attr("username");"undefined"!=typeof e&&0===$('td:contains("'+e+'")',t).length&&(n[1]=e,n[3]=$(this).attr("eventtime"),t.append(n.join("")))})})},nbApp.initUI=function(){$("#toggle-nav-app").mousedown(function(e){e.preventDefault(),nbApp.uiToggleNavApp()}),$("#toggle-nav-ws").mousedown(function(e){e.preventDefault(),nbApp.uiToggleNavWorkspace()}),$("#toggle-head-search").click(function(){nbApp.toggleSearchForm()}),$("#search-close").mousedown(function(){nbApp.toggleSearchForm()}),$("#content-overlay")&&($("#content-overlay").mousedown(function(e){e.preventDefault(),nbApp.uiHideOpenedNav()}),$("#content-overlay")[0].addEventListener("touchstart",function(e){e.preventDefault(),nbApp.uiHideOpenedNav()
},!1)),$('[data-role="side-tree-toggle"]').click(function(){$(this).parent().toggleClass("side-tree-collapse")}),$('[data-role="toggle"]').click(function(){$(this).parent().toggleClass($(this).data("toggle-class"))}),$(".action_save_user_profile").click(function(){nbApp.saveUserProfile()}),$(".action_save_and_close").click(function(){nbApp.saveDoc(frm.last_page.value)}),$(".action_delete_document").click(function(e){return e.preventDefault(),$(e.target).hasClass("disabled")===!1&&nbApp.delSelectedDocument(),!1}),$("[name=docid]:checkbox").bind("change",function(e){nbApp.uiToggleAvailableActions(e)}),$("[data-toggle=docid]:checkbox").bind("click",function(e){nbApp.uiToggleAvailableActions(e)}),nbApp.attachInitFileUpload("#fileupload"),"undefined"!=typeof $.fn.tabs&&$("#tabs").tabs(),$(".js-swipe-entry").on("touchend",function(e){nbApp.touch.touchEnd(e)}),$(".js-swipe-entry").on("touchmove",function(e){nbApp.touch.touchMove(e)}),$(".js-swipe-entry").bind("touchstart",function(e){nbApp.touch.touchStart(e)}),$(".entries").on("touchend",function(){}),$(".entries").on("touchmove",function(){}),$(".entries").bind("touchstart",function(){})},nbApp.xhrSaveUserProfile=function(e){return nb.ajax({type:"POST",url:"Provider?type=save&element=user_profile",datatype:"html",data:$(e).serialize()})},nbApp.xhrDeleteDocument=function(e){return nb.ajax({type:"POST",datatype:"XML",url:"Provider?type=page&id=delete_document&nocache="+Date.now(),data:e})},nbApp.xhrDocThreadExpand=function(e,t){return nb.ajax({method:"GET",datatype:"html",url:"Provider",data:{type:"view",id:"docthread",parentdocid:e,parentdoctype:t,command:"expand`"+e+"`"+t}})},nbApp.xhrDocThreadCollapse=function(e,t){return nb.ajax({method:"GET",url:"Provider?type=view&id=docthread&command=collaps`"+e+"`"+t})},nbApp.initScrollSpySide=function(){function e(){window.pageYOffset>t?n||(o.css("top","0px"),n=!0):n&&(o.css("top",""),n=!1)}var t=0,n=!1,o=$(".nav-app");o.length&&(t=$(".layout_header")[0].clientHeight,$(window).scroll(e),e())},nbApp.initScrollSpyActionBar=function(){function e(){window.pageYOffset>t?n||(o.addClass("action-bar-fixed"),n=!0):n&&(o.removeClass("action-bar-fixed"),n=!1)}var t=0,n=!1,o=$(".action-bar-top");if(o.length&&o.find(".pagination, .btn").length){var a=o.parent();a.css("min-height",a.height()+"px"),t=o[0].clientHeight+a.height(),o.css("width",o[0].clientWidth),$(window).scroll(e),e()}},nbStrings={RUS:{yes:"Да",no:"Нет",ok:"Ok",cancel:"Отмена",select:"Выбрать",dialog_select_value:"Вы не сделали выбор",no_selected_documents:"Не выбран документ(ы)",search:"Поиск",comment:"Комментарий",document_saved:"Документ сохранен",document_mark_as_read:"Документ отмечен как прочтенный",wait_while_document_save:"Пожалуйста ждите... идет сохранение документа",add_comment:"Добавить комментарий",attention:"Внимание"},KAZ:{yes:"Ия",no:"Жоқ",ok:"Ok",cancel:"Болдырмау",select:"Таңдау",dialog_select_value:"Вы не сделали выбор",no_selected_documents:"Не выбран документ(ы)",search:"Поиск",comment:"Комментарий",document_saved:"Документ сохранен",document_mark_as_read:"Документ отмечен как прочтенный",wait_while_document_save:"Пожалуйста ждите... идет сохранение документа",add_comment:"Добавить комментарий",attention:"Внимание"},ENG:{},CHN:{}};var calendarStrings={RUS:{monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]},KAZ:{monthNames:["Қаңтар","Ақпан","Наурыз","Сәуір","Мамыр","Маусым","Шілде","Тамыз","Қыркүйек","Қазан","Қараша","Желтоқсан"],monthNamesShort:["Қаңтар","Ақпан","Наурыз","Сәуір","Мамыр","Маусым","Шілде","Тамыз","Қыркүйек","Қазан","Қараша","Желтоқсан"],dayNames:["жексебі","дүйсенбі","сейсенбі","сәрсенбі","бейсенбі","жұма","сенбі"],dayNamesShort:["жек","дүй","сей","сәр","бей","жұм","сен"],dayNamesMin:["Жс","Дс","Сс","Ср","Бс","Жм","Сн"]},ENG:{monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk"},CHN:{closeText:"关闭",prevText:"&#x3c;上月",nextText:"下月&#x3e;",currentText:"今天",monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthNamesShort:["一","二","三","四","五","六","七","八","九","十","十一","十二"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],weekHeader:"周",yearSuffix:"年"}};$(function(){nbApp.touch={};var e=nbApp.touch,t=150,n=80,o=200,a=70,i=10,r=10,s=!0,c="js-swipe";e.touchStart=function(t){1===t.originalEvent.touches.length&&(e.tapSwipedMessage=Boolean(e.swipedMsg),e.hideSwipedMsg(),e.resetValue(t))},e.touchMove=function(t){var n=t.originalEvent.changedTouches[0];e.isValidTouch(t)&&(e.delta=e.x-n.pageX,e.defineUserAction(n),e.startSwipe&&(e.startSwipeTriggered||(e.startSwipeTriggered=!0),s&&e.move(t.currentTarget),t.preventDefault()))},e.touchEnd=function(t){if(e.isValidTouch(t,!0)&&e.startSwipe){if(e.swipedMsg=t.currentTarget,e.delta>n||new Date-e.startTime<o){e.swipedMsg.style.cssText="";var a=$(e.swipedMsg).parent(".entry-wrap");a.addClass("entry-action-open"),e.swipedMsg.classList.add(c)}else e.hideSwipedMsg();t.stopPropagation(),t.preventDefault()}},e.hideSwipedMsg=function(){if(e.swipedMsg){var n=e.swipedMsg;setTimeout(function(){n.classList.remove(c),n=null},t),e.swipedMsg.style.cssText="";var o=$(e.swipedMsg).parent(".entry-wrap");o.removeClass("entry-action-open"),e.swipedMsg=null}},e.resetValue=function(t){var n=t.originalEvent.changedTouches[0];e.touchId=n.identifier,e.startTime=new Date,e.startSwipe=!1,e.startScroll=!1,e.delta=0,e.x=n.pageX,e.y=n.pageY,e.startSwipeTriggered=!1},e.bindEvents=function(t,n){t["touchstart "+n]=e.touchStart,t["touchend "+n]=e.touchEnd,t["touchmove "+n]=e.touchMove},e.defineUserAction=function(t){Math.abs(e.y-t.pageY)>r&&!e.startSwipe?e.startScroll=!0:e.delta>i&&!e.startScroll&&(e.startSwipe=!0)},e.isValidTouch=function(t,n){var o=n?"changedTouches":"targetTouches";return t.originalEvent[o][0].identifier===e.touchId},e.move=function(t){var n=Math.min(-e.delta,0);-a>n&&(n=-a+(a+n)/8),t.style.cssText="transition:transform 0ms ease-in-out;-moz-transform:translate3d("+n+"px,0,0);-webkit-transform:translate3d("+n+"px,0,0);transform:translate3d("+n+"px,0,0)"}}),$(function(){function e(){o||(window.pageYOffset>300?t||(r.show(),s.html(a),t=!0):t&&(r.hide(),s.html(i),t=!1))}var t=!1,n=0,o=!1,a="▲",i="▼",r=$('<div class="to_top"><div class="to_top-panel"><div class="to_top-button"></div></div></div>');$("body").append(r);var s=$(".to_top-button",r);$(".to_top-panel",r).click(function(){o=!0,n?(s.html(a),$.scrollTo($("body"),100,{axis:"y",offset:n}),n=0):(n=window.pageYOffset,s.html(i),$.scrollTo($("body"),100,{axis:"y"}))}),$(document).bind("mousewheel",function(i,c){o?(o=!1,n=0,s.html(a),0==window.pageYOffset&&c>0&&e()):t&&0==window.pageYOffset&&(r.hide(),t=!1,n=0)}),$(window).scroll(e),e()}),nbApp.saveUserProfile=function(){return $("#newpwd").val()!=$("#newpwd2").val()?void nb.dialog.warn({message:"Введенные пароли не совпадают"}):void nbApp.xhrSaveUserProfile($("form")[0]).then(function(e){var t=$(e).find("redirect").text();""===t&&(t=$(e).find("history").find("entry[type=page]:last").text()),$.cookie("lang",$("select[name=lang]").val(),{path:"/",expires:30}),$.cookie("refresh",$("select[name=refresh]").val(),{path:"/",expires:30}),$.cookie("skin",$("select[name=skin]").val(),{expires:30}),""===t?window.history.back():window.location=t},function(e){400===e.status&&(-1!=e.responseText.indexOf("Old password has not match")?nb.dialog.warn({message:"Некорректно заполнено поле [пароль по умолчанию]"}):nb.dialog.error({message:e.responseText}))})},nbApp.getSelectedDocumentsIDs=function(e){var t=$("input[name="+(e||"docid")+"]:checked");if(0===t.length)return[];var n=[];return t.each(function(){n.push($(this).attr("id"))}),n},nbApp.getSelectedDocumentsAsParam=function(){var e=nbApp.getSelectedDocumentsIDs();if(0===e.length)return"";var t=[];for(var n in e)t.push("docid="+e[n]);return t.join("&")},nbApp.delSelectedDocument=function(e){var t;if(t=e?"docid="+e:nbApp.getSelectedDocumentsAsParam(),0===t.length)return void nb.utils.notify({message:nb.getText("no_selected_documents","Не выбран документ для удаления"),type:"error"}).show().remove(2e3);var n=nbApp.xhrDeleteDocument(t);n.then(function(e){var t=$(e).find("deleted").attr("count"),n=$(e).find("undeleted").attr("count"),o=[],a=[];$(e).find("deleted").find("entry").not(':contains("undefined")').each(function(){o.push("<li>"+$(this).text()+"</li>")}),$(e).find("undeleted").find("entry").not(':contains("undefined")').each(function(){a.push("<li>"+$(this).text()+"</li>")});var i;i=0===o.length||n>0?nb.getText("error_delete","Ошибка удаления"):nb.getText("deletion_successful","Удаление завершено успешно");var r=[];r.push("<div style=font-size:.9em;><b>Удалено:</b> "),r.push(t),r.push("<ul>"),r.push(o.join("")),r.push("</ul>"),r.push("<b>Не удалено:</b> "),r.push(n),r.push("<ul>"),r.push(a.join("")),r.push("</ul></div>");var s=nb.dialog.show({title:i,message:r.join(""),buttons:{Ok:{text:nb.getText("ok"),click:function(){s.dialog("close")}}},close:function(){location.reload()}})},function(){nb.dialog.error({message:nb.getText("error_delete","Ошибка удаления")})})},nbApp.docAddToFav=function(e,t,n){nb.xhr.addDocumentToFavorite(t,n).then(function(){$(e).attr({src:"/SharedResources/img/iconset/star_full.png",onclick:'nbApp.docRemoveFromFav(this, "'+t+'", "'+n+'")'})},function(){nb.dialog.error({message:"Ошибка добавления в избранное"})})},nbApp.docRemoveFromFav=function(e,t,n){nb.xhr.removeDocumentFromFavorite(t,n).then(function(){$(e).attr({src:"/SharedResources/img/iconset/star_empty.png",onclick:'nbApp.docAddToFav(this, "'+t+'", "'+n+'")'})},function(){nb.dialog.error({message:"Ошибка удаления из избранного"})})},nbApp.viewSortColumn=function(e,t,n){nb.xhr.sendSortRequest(e,t,n).then(function(){window.location.reload()})},nbApp.viewThreadExpand=function(e,t,n,o){nbApp.xhrDocThreadExpand(e,t).then(function(a){$(a).insertAfter("."+e);var i='javascript:nbApp.viewThreadCollapse("'+e+'", "'+t+'", "'+n+'", "'+o+'")';$("#a"+e).attr("href",i),$("#img"+e).attr("src","/SharedResources/img/classic/1/minus1.png")})},nbApp.viewThreadCollapse=function(e,t,n,o){nbApp.xhrDocThreadCollapse(e,t).then(function(){$("."+e).next("tr").replaceWith("")});var a='javascript:nbApp.viewThreadExpand("'+e+'", "'+t+'", "'+n+'" , "'+o+'")';$("#a"+e).attr("href",a),$("#img"+e).attr("src","/SharedResources/img/classic/1/plus1.png")},nbApp.filterChoose=function(e,t){nb.xhr.chooseFilter(page_id.value,t,e).then(function(){window.location.reload()})},nbApp.filterReset=function(){nb.xhr.resetFilter(page_id.value).then(function(){window.location.reload()})},nbApp.filterResetCurrent=function(e){nb.xhr.resetCurrentFilter(page_id.value,e).then(function(){window.location.reload()})},nbApp.inViewEdit=function(){var e=nbApp.inViewEdit,t=$("[data-action=add_new]"),n=$(".layout_content");e.contentInit=function(){$("[data-action=save]").on("click",function(e){e.preventDefault()}),$("[data-action=close]").on("click",function(e){t.removeClass("hidden"),window.history.back(-1),e.preventDefault()}),$(".entry-link").on("click",function(t){e.edit(this.href),t.preventDefault()})},e.edit=function(o){o!=window.location&&window.history.pushState(null,null,o),t.addClass("hidden"),$("#main-load").show(),$.get(o).then(function(t){n.html(t),$("#main-load").hide(),e.contentInit()})},t.on("click",function(t){e.edit(this.href),t.preventDefault()}),$("a",".side").on("click",function(t){e.edit(this.href),t.preventDefault()}),$(window).bind("popstate",function(t){e.edit(location.href),t.preventDefault()})},$(function(){}),nbApp.dialogChoiceCategory=function(e){var t=nb.dialog.show({targetForm:e.form.name,fieldName:"category",title:e.title,maxHeight:500,minHeight:440,width:500,href:"Provider?type=page&id=picklist-category&page=1",onExecute:function(){if(nb.form.setValues(t,null)){var e,n,o,a=$("[data-type='select']:checked",t[0]);if($(a[0]).hasClass("js-response")){var i=$(a[0]).parents(".js-parent"),r=i.children("label:first"),s=r.text();$("#categorytbl").html(s+" / "+$("#categorytbl").text()),e=$("[name='viewtext3']",r).val(),n="1"==$("[name='viewtext5']",r).val(),o="1"==$("[name='viewtext6']",r).val()}else e=$("[data-id="+a[0].value+"][name='viewtext3']").val(),n="1"==$("[data-id="+a[0].value+"][name='viewtext5']").val(),o="1"==$("[data-id="+a[0].value+"][name='viewtext6']").val();"in"==e||"out"==e?($("input[name=targetcash]").val(""),$("#targetcashtbl").html(""),$("#control-row-targetcash").hide()):"transfer"==e?($("#control-row-targetcash").show(),$("input[name=costcenter]").val(""),$("#costcentertbl").html("")):"calcstuff"==e?($("#control-row-targetcash").show(),$("input[name=costcenter]").val(""),$("#costcentertbl").html("")):"getcash"==e&&(o=!0),n?($("[name=documented]").attr("required","required").attr("checked",!0),$("[name=documented]").attr("onclick","return false"),$("[name=documented]").attr("onkeydown","return false")):($("[name=documented]").removeAttr("required").removeAttr("disabled"),$("[name=documented]").attr("onclick",null),$("[name=documented]").attr("onkeydown",null)),o?$("[name=costcenter]").attr("required","required"):$("[name=costcenter]").removeAttr("required").removeAttr("disabled"),$("#subcategorytbl").html(""),$("#typeoperationtbl").attr("class","operation-type-icon-"+e).attr("title",e),$("input[name=typeoperation]").val(e),$("input[name=subcategory]").val(""),t.dialog("close")}},buttons:{ok:{text:nb.getText("select"),click:function(){t[0].dialogOptions.onExecute()}},cancel:{text:nb.getText("cancel"),click:function(){t.dialog("close")}}},close:function(){$("input[name=summa]").focus()}})},nbApp.dialogChoiceTargetCash=function(e){var t=nb.dialog.show({targetForm:e.form.name,fieldName:"targetcash",title:e.title,href:"Provider?type=page&id=picklist-cash&page=1",buttons:{ok:{text:nb.getText("select"),click:function(){t[0].dialogOptions.onExecute()}},cancel:{text:nb.getText("cancel"),click:function(){t.dialog("close")}}},close:function(){$("input[name=summa]").focus()}})},nbApp.dialogChoiceCostCenter=function(e){var t=nb.dialog.show({targetForm:e.form.name,fieldName:"costcenter",title:e.title,href:"Provider?type=page&id=picklist-costcenter&page=1",buttons:{ok:{text:nb.getText("select"),click:function(){t[0].dialogOptions.onExecute()}},cancel:{text:nb.getText("cancel"),click:function(){t.dialog("close")}}},close:function(){$("textarea[name=basis]").focus()}})},nbApp.dialogChoiceBossAndDemp=function(e,t,n){var o=nb.dialog.show({targetForm:e.form.name,fieldName:t,dialogFilterListItem:".tree-entry",title:e.title,maxHeight:500,minHeight:440,width:500,href:"Provider?type=view&id=bossandemppicklist&page=1&fieldName="+t+"&isMulti="+n,onLoad:function(){n===!1&&$("[type='checkbox'][data-type='select']",o[0]).attr("type","radio")},buttons:{select:{text:nb.getText("select"),click:function(){o[0].dialogOptions.onExecute()}},cancel:{text:nb.getText("cancel"),click:function(){o.dialog("close")}}}})},nbApp.dialogChoiceAccessRoles=function(e){var t=nb.dialog.show({targetForm:e.form.name,fieldName:"accessroles",title:e.title,href:"Provider?type=view&id=picklist-roles&page=1",buttons:{ok:{text:nb.getText("select"),click:function(){t[0].dialogOptions.onExecute()}},cancel:{text:nb.getText("cancel"),click:function(){t.dialog("close")}}}})},nbApp.dialogChoiceCategoryForFormula=function(e){var t=nb.dialog.show({targetForm:e.form.name,fieldName:"formula",title:e.title,maxHeight:500,minHeight:440,width:500,href:"Provider?type=page&id=picklist-category-formula&page=1",onExecute:function(){var e=$("[data-type='select']:checked",t[0]);if(0===e.length)return!1;var n=e.data("id");nb.ajax({url:"Provider?type=page&id=get-document-data",method:"GET",dataType:"json",data:{ddbid:n,items:"comment"}}).then(function(e){$("[name='formula']").val("#"+n+"@"+e.comment+"#"),t.dialog("close")})},buttons:{ok:{text:nb.getText("select"),click:function(){t[0].dialogOptions.onExecute()}},cancel:{text:nb.getText("cancel"),click:function(){t.dialog("close")}}},close:function(){$("[name=formula]").focus()}})},nbApp.sendInvite=function(e){nbApp.xhrSendInvite(e).then(function(e){console.log(e)})},nbApp.oauth=function(e){var t={vk:{providerID:"vk",authorization:"https://oauth.vk.com/authorize",client_id:"4832372",response_type:"token",state:"",scope:"email",redirect_uri:"http://localhost:7777/CashTracker/Provider?type=page&id=alloperations"}};return new JSO(t[e])},nbApp.xhrGetSaldoOnDate=function(e){return nb.ajax({method:"GET",url:"Provider?type=page&id=saldo_on_date&ddbid="+e})},nbApp.xhrGetSaldoSum=function(){return nb.ajax({method:"GET",url:"Provider?type=page&id=saldo-sum"})},nbApp.xhrSendInvite=function(e){return nb.ajax({cache:!1,method:"POST",url:"Provider?type=page&id=send-invite&invite_to="+e+"&nocache="+Date.now()})},nbApp.xhrGetCostCenterJson=function(){return nb.ajax({method:"GET",datatype:"JSON",url:"Provider?type=page&id=costcenter-json"})},nbApp.appendSaldoToElTitleByDocDate=function(e,t){nbApp.xhrGetSaldoOnDate(t).then(function(t){$(e).attr("title",t)})},$(document).ready(function(){$(".js_saldo_on_date",".view").on("mouseover",function(){nbApp.appendSaldoToElTitleByDocDate(this,$(this).data("ddbid")),$(this).off("mouseover")}),$(".action-delete",".view").on("click",function(e){nbApp.delSelectedDocument($(this).data("ddbid")),e.preventDefault()})}),nbApp.expandCollapseCategory=function(e,t,n){e.classList.contains("minus")?nb.ajax({method:"GET",datatype:"html",url:"Provider",data:{type:"page",id:"category-child",parentdocid:t,parentdoctype:n,command:"expand`"+t+"`"+n}}).then(function(){console.log(this)}):nb.ajax({method:"GET",url:"Provider?type=page&id=category-child&command=collaps`"+t+"`"+n}).then(function(){console.log(this)})},nbApp.wlc={},nbApp.wlc.init=function(){var e=$("form[name=form-reg]");e.submit(function(e){e.preventDefault(),nbApp.wlc.reg(this)}),$("input",e).blur(function(){$(this).attr("required")&&$(this).val()&&$(this).removeClass("invalid")}),$("input",e).focus(function(){$(this).removeClass("invalid"),$(".reg-email-invalid,.reg-email-exists,.reg-pwd-weak").css("height","0px")})},nbApp.wlc.setLang=function(e){$.cookie("lang",e,{path:"/"}),window.location.reload()},nbApp.wlc.reg=function(e){return $(e).hasClass("process")?!1:($("input",e).removeClass("invalid"),$(".reg-email-invalid,.reg-email-exists,.reg-pwd-weak",e).css("height","0px"),$(e).addClass("process"),void nb.ajax({method:"POST",datatype:"text",url:"Provider?client="+screen.height+"x"+screen.width,data:$(e).serialize(),success:function(t){var n=t.split(",");-1!=n.indexOf("email")&&($("input[name=email]",e).addClass("invalid"),$(".reg-email-invalid").css("height","auto")),-1!=n.indexOf("user-exists")&&$(".reg-email-exists",e).css("height","auto"),-1!=n.indexOf("pwd-weak")&&($("input[name=pwd]",e).addClass("invalid"),$(".reg-pwd-weak",e).css("height","auto"));var o=!1;-1!=n.indexOf("user-reg")&&(console.log("user-reg"),o=!0),-1!=n.indexOf("ok")&&console.log("ok");-1!=n.indexOf("verify-email-send")&&nb.utils.notify({type:"info",message:"Для завершения регистрации подтвердите свой email"}).show()},error:function(e){console.log(e)},complete:function(){$(e).removeClass("process")}}))};