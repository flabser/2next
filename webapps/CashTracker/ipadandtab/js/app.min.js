function sorting(e,t,n){nb.xhr.sendSortRequest(e,t,n).then(function(){window.location.reload()})}function resetFilter(e){nb.xhr.resetFilter(e).then(function(){window.location.reload()})}function usersWhichReadInTable(e,t,n){nb.xhr.getUsersWichRead(n,t).then(function(e){var t=$("#userswhichreadtbl"),n=["<tr><td>","1","</td><td>","3","</td></tr>"];$(e).find("entry").each(function(){var e=$(this).attr("username");void 0!==e&&0===$("td:contains('"+e+"')",t).length&&(n[1]=e,n[3]=$(this).attr("eventtime"),t.append(n.join("")))})})}function markRead(e,t){setTimeout(function(){nb.xhr.markDocumentAsRead(t,e).then(function(){nbApp.ui.notify(nb.getText("document_mark_as_read"))})},2e3)}function delDocument(){var e=$("input[name='chbox']:checked");if(e.length<1)return void nbApp.ui.notify(nb.getText("document_not_selected"));var t=[];e.each(function(e,n){t.push("docid="+$(n).val())}),$.ajax({cache:!1,type:"POST",datatype:"XML",url:"Provider?type=page&id=delete_document",data:t.join("&"),success:function(e){var t=nbApp.parseMessageToJson(e);if("ok"!==t.page.response.status)return void nbApp.ui.notify({msg:"<div>"+nb.getText("delete_error")+"</div>"+t.page.response.message,type:"error",timeout:3e3});var n=t.page.response.content.delete_document,o=n.deleted.count,r=n.undeleted.count,i="";0!=r&&(i+=nb.getText("undeleted")+": "+r+"<br/>"),i+=nb.getText("deleted")+": "+o;var a=n.deleted.entry;i+="string"==typeof a?"<div>"+a+"</div>":"<div>"+a.join("<br/>")+"</div>",nb.utils.blockUI();var s=nb.getText("successfully_deleted");s+="<div style='padding:4px;text-align:left;'>"+i+"</div>",s+="<div style='padding:4px;text-align:right;'><b>OK</b></div>",nbApp.ui.notify({msg:s,timeout:-1,callback:function(){window.location.reload()}})},error:function(){nbApp.ui.notify({msg:nb.getText("delete_error"),type:"error"})}})}function chooseFilter(e,t){nb.xhr.chooseFilter(page_id.value,t,e).then(function(){window.location.reload()})}function resetFilter(){nb.xhr.resetFilter(page_id.value).then(function(){window.location.reload()})}function resetCurrentFilter(e){nb.xhr.resetCurrentFilter(page_id.value,e).then(function(){window.location.reload()})}function toggleFilterList(e){$(e).parents(".filter-entry-list-wrapper").find(".filter-entry-list").toggleClass("visible")}function makeResponsiveDialog(e){var t=$(e.target).parents("[role=dialog]"),n=$(".ui-dialog-buttonpane",t).outerHeight(),o=$(t).outerHeight();t.css("height",o-n),$(e.target).css("height",o-2*n-10)}function saveUserProfile(){return $("#newpwd").val()!=$("#newpwd2").val()?void nbApp.ui.notify("Введенные пароли не совпадают"):void $.ajax({type:"POST",url:"Provider?type=save&element=user_profile",datatype:"html",data:$("#frm").serialize(),success:function(e){var t=$(e).find("redirect").text();""==t&&(t=$(e).find("history").find("entry[type=page]:last").text()),$.cookie("lang",$("select[name='lang']").val(),{path:"/",expires:30}),$.cookie("refresh",$("select[name='refresh']").val(),{path:"/",expires:30}),$.cookie("skin",$("select[name='skin']").val(),{expires:30}),""==t?window.history.back():window.location=t},error:function(e){400==e.status&&nbApp.ui.notify(-1!=e.responseText.indexOf("Old password has not match")?"Некорректно заполнено поле 'пароль по умолчанию'":{msg:"Error",type:"error"})}})}window.Modernizr=function(e,t,n){function o(e){y.cssText=e}function r(e,t){return o(k.join(e+";")+(t||""))}function i(e,t){return typeof e===t}function a(e,t){return!!~(""+e).indexOf(t)}function s(e,t){for(var o in e){var r=e[o];if(!a(r,"-")&&y[r]!==n)return"pfx"==t?r:!0}return!1}function l(e,t,o){for(var r in e){var a=t[e[r]];if(a!==n)return o===!1?e[r]:i(a,"function")?a.bind(o||t):a}return!1}function c(e,t,n){var o=e.charAt(0).toUpperCase()+e.slice(1),r=(e+" "+C.join(o+" ")+o).split(" ");return i(t,"string")||i(t,"undefined")?s(r,t):(r=(e+" "+T.join(o+" ")+o).split(" "),l(r,t,n))}function d(){m.input=function(n){for(var o=0,r=n.length;r>o;o++)O[n[o]]=!!(n[o]in $);return O.list&&(O.list=!(!t.createElement("datalist")||!e.HTMLDataListElement)),O}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),m.inputtypes=function(e){for(var o,r,i,a=0,s=e.length;s>a;a++)$.setAttribute("type",r=e[a]),o="text"!==$.type,o&&($.value=w,$.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(r)&&$.style.WebkitAppearance!==n?(h.appendChild($),i=t.defaultView,o=i.getComputedStyle&&"textfield"!==i.getComputedStyle($,null).WebkitAppearance&&0!==$.offsetHeight,h.removeChild($)):/^(search|tel)$/.test(r)||(o=/^(url|email)$/.test(r)?$.checkValidity&&$.checkValidity()===!1:$.value!=w)),A[e[a]]=!!o;return A}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var u,p,f="2.7.2",m={},g=!0,h=t.documentElement,b="modernizr",v=t.createElement(b),y=v.style,$=t.createElement("input"),w=":)",x={}.toString,k=" -webkit- -moz- -o- -ms- ".split(" "),_="Webkit Moz O ms",C=_.split(" "),T=_.toLowerCase().split(" "),S={svg:"http://www.w3.org/2000/svg"},E={},A={},O={},P=[],j=P.slice,M=function(e,n,o,r){var i,a,s,l,c=t.createElement("div"),d=t.body,u=d||t.createElement("body");if(parseInt(o,10))for(;o--;)s=t.createElement("div"),s.id=r?r[o]:b+(o+1),c.appendChild(s);return i=["&#173;",'<style id="s',b,'">',e,"</style>"].join(""),c.id=b,(d?c:u).innerHTML+=i,u.appendChild(c),d||(u.style.background="",u.style.overflow="hidden",l=h.style.overflow,h.style.overflow="hidden",h.appendChild(u)),a=n(c,e),d?c.parentNode.removeChild(c):(u.parentNode.removeChild(u),h.style.overflow=l),!!a},F=function(){function e(e,r){r=r||t.createElement(o[e]||"div"),e="on"+e;var a=e in r;return a||(r.setAttribute||(r=t.createElement("div")),r.setAttribute&&r.removeAttribute&&(r.setAttribute(e,""),a=i(r[e],"function"),i(r[e],"undefined")||(r[e]=n),r.removeAttribute(e))),r=null,a}var o={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return e}(),D={}.hasOwnProperty;p=i(D,"undefined")||i(D.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(e,t){return D.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=j.call(arguments,1),o=function(){if(this instanceof o){var r=function(){};r.prototype=t.prototype;var i=new r,a=t.apply(i,n.concat(j.call(arguments)));return Object(a)===a?a:i}return t.apply(e,n.concat(j.call(arguments)))};return o}),E.flexbox=function(){return c("flexWrap")},E.canvas=function(){var e=t.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},E.canvastext=function(){return!(!m.canvas||!i(t.createElement("canvas").getContext("2d").fillText,"function"))},E.webgl=function(){return!!e.WebGLRenderingContext},E.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:M(["@media (",k.join("touch-enabled),("),b,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=9===e.offsetTop}),n},E.geolocation=function(){return"geolocation"in navigator},E.postmessage=function(){return!!e.postMessage},E.websqldatabase=function(){return!!e.openDatabase},E.indexedDB=function(){return!!c("indexedDB",e)},E.hashchange=function(){return F("hashchange",e)&&(t.documentMode===n||t.documentMode>7)},E.history=function(){return!(!e.history||!history.pushState)},E.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},E.websockets=function(){return"WebSocket"in e||"MozWebSocket"in e},E.rgba=function(){return o("background-color:rgba(150,255,150,.5)"),a(y.backgroundColor,"rgba")},E.hsla=function(){return o("background-color:hsla(120,40%,100%,.5)"),a(y.backgroundColor,"rgba")||a(y.backgroundColor,"hsla")},E.multiplebgs=function(){return o("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(y.background)},E.backgroundsize=function(){return c("backgroundSize")},E.borderimage=function(){return c("borderImage")},E.borderradius=function(){return c("borderRadius")},E.boxshadow=function(){return c("boxShadow")},E.textshadow=function(){return""===t.createElement("div").style.textShadow},E.opacity=function(){return r("opacity:.55"),/^0.55$/.test(y.opacity)},E.cssanimations=function(){return c("animationName")},E.csscolumns=function(){return c("columnCount")},E.cssgradients=function(){var e="background-image:",t="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return o((e+"-webkit- ".split(" ").join(t+e)+k.join(n+e)).slice(0,-e.length)),a(y.backgroundImage,"gradient")},E.cssreflections=function(){return c("boxReflect")},E.csstransforms=function(){return!!c("transform")},E.csstransforms3d=function(){var e=!!c("perspective");return e&&"webkitPerspective"in h.style&&M("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t){e=9===t.offsetLeft&&3===t.offsetHeight}),e},E.csstransitions=function(){return c("transition")},E.fontface=function(){var e;return M('@font-face {font-family:"font";src:url("https://")}',function(n,o){var r=t.getElementById("smodernizr"),i=r.sheet||r.styleSheet,a=i?i.cssRules&&i.cssRules[0]?i.cssRules[0].cssText:i.cssText||"":"";e=/src/i.test(a)&&0===a.indexOf(o.split(" ")[0])}),e},E.generatedcontent=function(){var e;return M(["#",b,"{font:0/0 a}#",b,':after{content:"',w,'";visibility:hidden;font:3px/1 a}'].join(""),function(t){e=t.offsetHeight>=3}),e},E.video=function(){var e=t.createElement("video"),n=!1;try{(n=!!e.canPlayType)&&(n=new Boolean(n),n.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(o){}return n},E.audio=function(){var e=t.createElement("audio"),n=!1;try{(n=!!e.canPlayType)&&(n=new Boolean(n),n.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),n.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),n.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(o){}return n},E.localstorage=function(){try{return localStorage.setItem(b,b),localStorage.removeItem(b),!0}catch(e){return!1}},E.sessionstorage=function(){try{return sessionStorage.setItem(b,b),sessionStorage.removeItem(b),!0}catch(e){return!1}},E.webworkers=function(){return!!e.Worker},E.applicationcache=function(){return!!e.applicationCache},E.svg=function(){return!!t.createElementNS&&!!t.createElementNS(S.svg,"svg").createSVGRect},E.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==S.svg},E.smil=function(){return!!t.createElementNS&&/SVGAnimate/.test(x.call(t.createElementNS(S.svg,"animate")))},E.svgclippaths=function(){return!!t.createElementNS&&/SVGClipPath/.test(x.call(t.createElementNS(S.svg,"clipPath")))};for(var L in E)p(E,L)&&(u=L.toLowerCase(),m[u]=E[L](),P.push((m[u]?"":"no-")+u));return m.input||d(),m.addTest=function(e,t){if("object"==typeof e)for(var o in e)p(e,o)&&m.addTest(o,e[o]);else{if(e=e.toLowerCase(),m[e]!==n)return m;t="function"==typeof t?t():t,"undefined"!=typeof g&&g&&(h.className+=" "+(t?"":"no-")+e),m[e]=t}return m},o(""),v=$=null,function(e,t){function n(e,t){var n=e.createElement("p"),o=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",o.insertBefore(n.lastChild,o.firstChild)}function o(){var e=v.elements;return"string"==typeof e?e.split(" "):e}function r(e){var t=b[e[g]];return t||(t={},h++,e[g]=h,b[h]=t),t}function i(e,n,o){if(n||(n=t),d)return n.createElement(e);o||(o=r(n));var i;return i=o.cache[e]?o.cache[e].cloneNode():m.test(e)?(o.cache[e]=o.createElem(e)).cloneNode():o.createElem(e),!i.canHaveChildren||f.test(e)||i.tagUrn?i:o.frag.appendChild(i)}function a(e,n){if(e||(e=t),d)return e.createDocumentFragment();n=n||r(e);for(var i=n.frag.cloneNode(),a=0,s=o(),l=s.length;l>a;a++)i.createElement(s[a]);return i}function s(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return v.shivMethods?i(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+o().join().replace(/[\w\-]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(v,t.frag)}function l(e){e||(e=t);var o=r(e);return!v.shivCSS||c||o.hasCSS||(o.hasCSS=!!n(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),d||s(e,o),e}var c,d,u="3.7.0",p=e.html5||{},f=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,m=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,g="_html5shiv",h=0,b={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",c="hidden"in e,d=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return"undefined"==typeof e.cloneNode||"undefined"==typeof e.createDocumentFragment||"undefined"==typeof e.createElement}()}catch(n){c=!0,d=!0}}();var v={elements:p.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:u,shivCSS:p.shivCSS!==!1,supportsUnknownElements:d,shivMethods:p.shivMethods!==!1,type:"default",shivDocument:l,createElement:i,createDocumentFragment:a};e.html5=v,l(t)}(this,t),m._version=f,m._prefixes=k,m._domPrefixes=T,m._cssomPrefixes=C,m.hasEvent=F,m.testProp=function(e){return s([e])},m.testAllProps=c,m.testStyles=M,m.prefixed=function(e,t,n){return t?c(e,t,n):c(e,"pfx")},h.className=h.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(g?" js "+P.join(" "):""),m}(this,this.document),function(e,t,n){function o(e){return"[object Function]"==h.call(e)}function r(e){return"string"==typeof e}function i(){}function a(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function s(){var e=b.shift();v=1,e?e.t?m(function(){("c"==e.t?p.injectCss:p.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),s()):v=0}function l(e,n,o,r,i,l,c){function d(t){if(!f&&a(u.readyState)&&(y.r=f=1,!v&&s(),u.onload=u.onreadystatechange=null,t)){"img"!=e&&m(function(){w.removeChild(u)},50);for(var o in T[n])T[n].hasOwnProperty(o)&&T[n][o].onload()}}var c=c||p.errorTimeout,u=t.createElement(e),f=0,h=0,y={t:o,s:n,e:i,a:l,x:c};1===T[n]&&(h=1,T[n]=[]),"object"==e?u.data=n:(u.src=n,u.type=e),u.width=u.height="0",u.onerror=u.onload=u.onreadystatechange=function(){d.call(this,h)},b.splice(r,0,y),"img"!=e&&(h||2===T[n]?(w.insertBefore(u,$?null:g),m(d,c)):T[n].push(u))}function c(e,t,n,o,i){return v=0,t=t||"j",r(e)?l("c"==t?k:x,e,t,this.i++,n,o,i):(b.splice(this.i++,0,e),1==b.length&&s()),this}function d(){var e=p;return e.loader={load:c,i:0},e}var u,p,f=t.documentElement,m=e.setTimeout,g=t.getElementsByTagName("script")[0],h={}.toString,b=[],v=0,y="MozAppearance"in f.style,$=y&&!!t.createRange().compareNode,w=$?f:g.parentNode,f=e.opera&&"[object Opera]"==h.call(e.opera),f=!!t.attachEvent&&!f,x=y?"object":f?"script":"img",k=f?"script":x,_=Array.isArray||function(e){return"[object Array]"==h.call(e)},C=[],T={},S={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};p=function(e){function t(e){var t,n,o,e=e.split("!"),r=C.length,i=e.pop(),a=e.length,i={url:i,origUrl:i,prefixes:e};for(n=0;a>n;n++)o=e[n].split("="),(t=S[o.shift()])&&(i=t(i,o));for(n=0;r>n;n++)i=C[n](i);return i}function a(e,r,i,a,s){var l=t(e),c=l.autoCallback;l.url.split(".").pop().split("?").shift(),l.bypass||(r&&(r=o(r)?r:r[e]||r[a]||r[e.split("/").pop().split("?")[0]]),l.instead?l.instead(e,r,i,a,s):(T[l.url]?l.noexec=!0:T[l.url]=1,i.load(l.url,l.forceCSS||!l.forceJS&&"css"==l.url.split(".").pop().split("?").shift()?"c":n,l.noexec,l.attrs,l.timeout),(o(r)||o(c))&&i.load(function(){d(),r&&r(l.origUrl,s,a),c&&c(l.origUrl,s,a),T[l.url]=2})))}function s(e,t){function n(e,n){if(e){if(r(e))n||(u=function(){var e=[].slice.call(arguments);p.apply(this,e),f()}),a(e,u,t,0,c);else if(Object(e)===e)for(l in s=function(){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}(),e)e.hasOwnProperty(l)&&(!n&&!--s&&(o(u)?u=function(){var e=[].slice.call(arguments);p.apply(this,e),f()}:u[l]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),f()}}(p[l])),a(e[l],u,t,l,c))}else!n&&f()}var s,l,c=!!e.test,d=e.load||e.both,u=e.callback||i,p=u,f=e.complete||i;n(c?e.yep:e.nope,!!d),d&&n(d)}var l,c,u=this.yepnope.loader;if(r(e))a(e,0,u,0);else if(_(e))for(l=0;l<e.length;l++)c=e[l],r(c)?a(c,0,u,0):_(c)?p(c):Object(c)===c&&s(c,u);else Object(e)===e&&s(e,u)},p.addPrefix=function(e,t){S[e]=t},p.addFilter=function(e){C.push(e)},p.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",u=function(){t.removeEventListener("DOMContentLoaded",u,0),t.readyState="complete"},0)),e.yepnope=d(),e.yepnope.executeStack=s,e.yepnope.injectJs=function(e,n,o,r,l,c){var d,u,f=t.createElement("script"),r=r||p.errorTimeout;f.src=e;for(u in o)f.setAttribute(u,o[u]);n=c?s:n||i,f.onreadystatechange=f.onload=function(){!d&&a(f.readyState)&&(d=1,n(),f.onload=f.onreadystatechange=null)},m(function(){d||(d=1,n(1))},r),l?f.onload():g.parentNode.insertBefore(f,g)},e.yepnope.injectCss=function(e,n,o,r,a,l){var c,r=t.createElement("link"),n=l?s:n||i;r.href=e,r.rel="stylesheet",r.type="text/css";for(c in o)r.setAttribute(c,o[c]);a||(g.parentNode.insertBefore(r,g),m(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};var nb={APP_NAME:location.hostname,LANG_ID:"RUS",debug:!0,strings:{yes:"Да",no:"Нет",ok:"Ok",cancel:"Отмена",select:"Выбрать",dialog_select_value:"Вы не сделали выбор"},form:{},dialog:{},utils:{},xhr:{}},nbApp={};nb.ajax=function(e){var t=$.ajax(e);return t.error(function(e){return console.error("nb.ajax : error",e),400==e.status&&nb.dialog.error({title:nb.getText("error_xhr","Ошибка запроса"),message:e.responseText}),e}),t},nb.getText=function(e,t,n){return nbStrings[n||this.LANG_ID][e]?nbStrings[n||this.LANG_ID][e]:void 0!==t?t:e},nb.openXML=function(){window.location.href=window.location+"&onlyxml"},nb.form.setValues=function(e){function t(){if(s){$("[name="+a+"]",i).remove();var e=[];n.each(function(t,n){$('<input type="hidden" name="'+a+'" value="'+n.value+'" />').appendTo(i),e.push("<li>"+$(n).data("text")+"</li>")}),$("#"+a+"tbl").html(e.join(""))}else{var t=$("[name="+a+"]",i);0===t.length&&(t=$('<input type="hidden" name="'+a+'" />'),$(i).append(t[0])),t.val(n[0].value),$("#"+a+"tbl").html("<li>"+n.attr("data-text")+"</li>")}return!0}var n,o=$(e).parents("[role=dialog]"),r=$('[data-role="nb-dialog"]',o),i=nb.utils.getForm(r[0].dialogOptions.targetForm),a=r[0].dialogOptions.fieldName,s=!1,l="";return i?(n=$('[data-type="select"]:checked',r[0]),n.length>0?(s=n.length>1,s||(l=""),t(n)):(r[0].dialogOptions.effect&&(o.stop(),o.effect(r[0].dialogOptions.effect,{times:2},300)),0===$(".js-no-selected-value",o[0]).length&&!function(){var e=$('<div class="alert alert-danger js-no-selected-value" style="border-radius:2px;top:55%;left:4%;right:4%;position:absolute;">'+r[0].dialogOptions.errorMessage+"</div>");r.after(e),setTimeout(function(){e.fadeOut({always:function(){e.remove()}})},800)}(),!1)):(nb.dialog.warn({title:"Error",message:"Error nb.form.setValues > form is not found: "+i}),!1)},nb.utils.clearField=function(e){$("[name="+e+"]").val(""),$("#"+e+"tbl").html("")},nb.utils.getForm=function(e){return null===e||void 0===e?e:"string"==typeof e&&document[e]&&"FORM"===document[e].nodeName?document[e]:e.form||e},nb.utils.blockUI=function(){var e=$("#nb-block-ui");0===e.length&&(e=$('<div id="nb-block-ui" style="background:rgba(0,0,0,0.1);position:fixed;top:0;left:0;bottom:0;right:0;z-index:999;"/>'),e.appendTo("body")),e.css("display","block")},nb.utils.unblockUI=function(){$("#nb-block-ui").css("display","none")},nb.utils.notify=function(e){var t=$("#nb-notify-wrapper");t.length||(t=$('<div id="nb-notify-wrapper" class="nb-notify"></div>').appendTo("body"));var n=$('<div class="nb-notify-entry-'+(e.type||"info")+'">'+e.message+"</div>").appendTo(t);return{show:function(){return n.css("display","block"),this},hide:function(){return n.css("display","none"),this},set:function(e){for(var t in e)"text"===t?n.text(e[t]):"type"===t&&n.attr("class","nb-notify-entry-"+e[t]);return this},remove:function(e,t){if(null!==n)if(e&&e>0){setTimeout(function(){n.remove(),n=null,t&&t()},e)}else n.remove(),n=null,t&&t()}}},$(document).ready(function(){nb.LANG_ID=$.cookie("lang")||"RUS",$(":checkbox").bind("click",function(){var e=$(this);if(!e.data("toggle"))return!0;var t=this.name||e.data("toggle"),n=$("[name="+t+"]:checkbox:visible");n.each(e.is(":checked")?function(){this.checked=!0}:function(){this.checked=!1})})}),nb.dialog={_props:{title:nb.APP_NAME},info:function(e){return e.className="dialog-info",e.width=e.width||"360",e.height=e.height||"210",e.buttons=e.buttons||{Ok:function(){$(this).dialog("close")}},this.show(e)},warn:function(e){return e.className="dialog-warn",e.width=e.width||"360",e.height=e.height||"210",e.buttons=e.buttons||{Ok:function(){$(this).dialog("close")}},this.show(e)},error:function(e){return e.className="dialog-error",e.width=e.width||"360",e.height=e.height||"210",e.buttons=e.buttons||{Ok:function(){$(this).dialog("close")}},this.show(e)},execute:function(e){var t=$(e).parents("[role=dialog]"),n=$("[data-role=nb-dialog]",t);n[0].dialogOptions.onExecute(arguments)},show:function(e){var t;if(e.id=e.id||null,e.title=e.title||this._props.title,e.href=e.href||null,e.className=e.className||"",e.message=e.message||null,e.filter=e.filter,e.dialogFilterListItem=e.dialogFilterListItem||"li",e.buttons=e.buttons||null,e.dialogClass="nb-dialog "+(e.dialogClass?e.dialogClass:""),e.errorMessage=e.errorMessage||nb.strings.dialog_select_value,e.onLoad=e.onLoad||null,e.onExecute=e.onExecute||function(){nb.form.setValues(t,null)&&t.dialog("close")},e.autoOpen=!0,e.modal=e.modal===!1?!1:!0,e.width=e.width||"360",e.position=e.position||"center",null===e.id&&e.href){if(e.id="dlg_"+e.href.replace(/[^a-z0-9]/gi,""),t=$("#"+e.id),t[0])return t.dialog("isOpen")===!0?void 0:void t.dialog("open")}else if(null!==e.id&&(t=$("#"+e.id),t[0]))return t.dialog("isOpen")===!0?void 0:void t.dialog("open");null===e.id&&(e.close=e.close||function(){t.dialog("destroy"),t.remove()});var n;return n=$(e.href?'<div data-role="nb-dialog" id="'+e.id+'" class="nb-dialog-container '+e.className+'"><div class="loading-state"></div></div>':e.id?'<div data-role="nb-dialog" id="'+e.id+'" class="nb-dialog-container '+e.className+'">'+e.message+"</div>":'<div data-role="nb-dialog" class="nb-dialog-container '+e.className+'">'+e.message+"</div>"),e.href?(t=n.load(e.href,"",function(t,o,r){if("error"===o)n.html('<div class="alert alert-danger">'+o+"</div>"),console.log("nb.dialog : load callback",r);else{try{null!==e.onLoad&&e.onLoad(t,o,r)}catch(i){console.log("nb.dialog",i)}try{e.filter!==!1&&new nb.dialog.Filter(n,e.dialogFilterListItem,13)}catch(i){console.log("nb.dialog",i)}}}).dialog(e),t.on("click","a",function(e){e.preventDefault(),n.load(this.href)}),t.on("change","select",function(e){e.preventDefault(),n.load(this.href)})):t=n.dialog(e),t[0].dialogOptions=e,nb.debug===!0&&console.log("nb.dialog: ",e),t}},nb.dialog.Filter=function(e,t,n,o){function r(){a=$(p,f[0]);var e=$(".toggle-response",f[0]).length>0;a.length<l&&!e||(0===$(".dialog-filter",m).length&&f.before('<div class="dialog-filter"></div>'),$(".dialog-filter",m).append('<label>Фильтр: <label><input type="text" name="keyword" data-role="search" />'),s=$(".dialog-filter input[data-role=search]",m),s.on("keyup",function(e){try{if(clearTimeout(u),13===e.keyCode)return}catch(t){console.log(t)}u=setTimeout(function(){a=$(p,f[0]),i(e.target.value)},d)}))}function i(e){try{if(e.length>=c){var t=0;a.attr("style","");var n=new RegExp(e,"gim");a.each(function(e,o){n.test(o.textContent)||0===$(":checked",o).length&&($(o).attr("style","display:none;"),t++)}),a.length>t?s.attr("title","By keyword ["+e+"] filtered "+(a.length-t)):s.attr("title","filter_no_results")}else a.attr("style",""),s.attr("title","")}catch(o){console.log(o)}}var a,s=null,l=n||13,c=o||2,d=300,u=null,p=t||".item",f=e,m=f.parents("[role=dialog]");r()},nb.windowOpen=function(e,t,n){var o,r=800,i=600,a=(window.innerHeight-i)/2,s=(window.innerWidth-r)/2;0>a&&(a=0),0>s&&(s=0),o="top="+a+",left="+s,o+=",height="+i+",width="+r+",resizable=yes,scrollbars=yes,status=no";var l="window-"+(t||e.hashCode()),c=window.open("",l,o);if(("about:blank"===c.document.URL||""===c.document.URL)&&(c=window.open(e,l,o),n&&n.onclose))var d=setInterval(function(){c.closed&&(clearInterval(d),n.onclose())},1e3);c.focus()},nb.xhr.deleteDocument=function(e,t){return nb.debug===!0&&console.log("nb.xhr.deleteDocument: ",e,t),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"delete",ck:e,typedel:t}})},nb.xhr.restoreDeletedDocument=function(e){return nb.debug===!0&&console.log("nb.xhr.restoreDeletedDocument: ",e),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"undelete",ck:e}})},nb.xhr.addDocumentToFavorite=function(e,t){return nb.debug===!0&&console.log("nb.xhr.addDocumentToFavorite: ",e,t),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"service",operation:"add_to_favourites",doctype:t,key:e}})},nb.xhr.removeDocumentFromFavorite=function(e,t){return nb.debug===!0&&console.log("nb.xhr.removeDocumentFromFavorite: ",e,t),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"service",operation:"remove_from_favourites",doctype:t,key:e}})},nb.xhr.markDocumentAsRead=function(e,t){return nb.debug===!0&&console.log("nb.xhr.markDocumentAsRead: ",e,t),nb.ajax({type:"POST",datatype:"XML",url:"Provider",data:{type:"service",operation:"mark_as_read",id:"mark_as_read",doctype:t,key:e}})},nb.xhr.getUsersWichRead=function(e,t){return nb.debug===!0&&console.log("nb.xhr.getUsersWichRead: ",e,t),nb.ajax({type:"GET",datatype:"XML",url:"Provider",data:{type:"service",operation:"users_which_read",id:"users_which_read",doctype:t,key:e}})},nb.xhr.saveDocument=function(e){e=e||{};var t=nb.utils.notify({message:nb.getText("wait_while_document_save","Пожалуйста ждите... идет сохранение документа"),type:"process"}).show(),n={cache:!1,type:"POST",datatype:"XML",url:"Provider",data:e.data||$("form").serialize(),beforeSend:function(){nb.utils.blockUI(),$(".required, [required]","form").removeClass("required").removeAttr("required")},success:function(n){var o=nb.utils.parseMessageToJson(n),r=o.message[0];if("ok"===o.status)t.set({text:nb.getText("document_saved","Документ сохранен"),type:"success"}),r.length>0?nb.dialog.info({message:r,close:function(){(o.redirect||e.redirect)&&(window.location.href=o.redirect||e.redirect)}}):(o.redirect||e.redirect)&&setTimeout(function(){window.location.href=o.redirect||e.redirect},300);else if(0===r.indexOf("require:")){var a=r.substr("require:".length).split(",");for(i=0;i<a.length;i++)$("#"+a[i]+"tbl").addClass("required"),$("[name="+a[i]+"]").attr("required","required").addClass("required");t.set({text:nb.getText("required_field_not_filled","Не заполнены обязательные поля"),type:"error"})}else t.set({text:r,type:"error"})},error:function(){t.set({text:nb.getText("error_xhr","Ошибка при выполнении запроса"),type:"error"})}},o=nb.ajax(n);return o.always(function(){nb.utils.unblockUI(),t.remove(2e3)}),o},nb.utils.parseMessageToJson=function(e){var t={};return $(e).find("response").each(function(){t.status=$(this).attr("status"),t.redirect=$("redirect",this).text(),t.message=[],$(this).find("message").each(function(){t.message.push($(this).text())})}),t},nb.xhr.chooseFilter=function(e,t,n){return nb.debug===!0&&console.log("nb.xhr.chooseFilter: ",e,t,n),nb.ajax({type:"GET",datatype:"XML",url:"Provider?param=filter_mode~on&param=filtered_column~"+t+"&param=key_word~"+n,cache:!1,data:{type:"service",operation:"tune_session",element:"page",id:e}})},nb.xhr.resetFilter=function(e){return nb.debug===!0&&console.log("nb.xhr.resetFilter: ",e),nb.ajax({type:"POST",datatype:"XML",url:"Provider",cache:!1,data:{type:"service",operation:"tune_session",element:"page",id:e,param:"filter_mode~reset_all"}})},nb.xhr.resetCurrentFilter=function(e,t){return nb.debug===!0&&console.log("nb.xhr.resetCurrentFilter: ",e,t),nb.ajax({type:"GET",datatype:"XML",url:"Provider?param=filter_mode~on&param=filtered_column~"+t,cache:!1,data:{type:"service",operation:"tune_session",element:"page",id:e}})};var nbStrings={RUS:{},KAZ:{},ENG:{},CHN:{}};nbStrings.RUS={yes:"Да",no:"Нет",ok:"Ok",cancel:"Отмена",select:"Выбрать",dialog_select_value:"Вы не сделали выбор"},nb.xhr.sendSortRequest=function(e,t,n){return nb.debug===!0&&console.log("nb.xhr.sendSortRequest: ",e,t,n),nb.ajax({type:"POST",datatype:"XML",url:"Provider?param=sorting_mode~on&param=sorting_column~"+t.toLowerCase()+"&param=sorting_direction~"+n.toLowerCase(),data:{type:"service",operation:"tune_session",element:"page",id:e}})};var nbApp={app_lang:"RUS",init:function(){this.menu.init(),this.ui.init()},parseMessageToJson:function(e){return $.xml2json(e)},menu:{init:function(){var e,t=!0,n=$(".sub-menu");t&&(e=$("<div class='menu-overlay' style='display:none;' />"),$("body").append(e),e.mousedown(function(t){t.preventDefault(),n.removeClass("active"),e[0].style.display="none",$("body").removeClass("nav-ws-open")}),e[0].addEventListener("touchstart",function(t){$("body").removeClass("nav-ws-open"),e[0].style.display="none",n.removeClass("active"),t.preventDefault()},!1)),$(".js-toggle-nav-ws").mousedown(function(t){t.preventDefault(),$("body").toggleClass("nav-ws-open"),e[0].style.display="block",n.removeClass("active")}),$("[data-role='menu-toggle']").mousedown(function(){var o=$(this).attr("data-class"),r=$(this).parent(),i=r.hasClass(o);n.removeClass(o),i?(t&&!r.hasClass("action-bar")&&(e[0].style.display="none"),r.removeClass(o)):(t&&!r.hasClass("action-bar")&&(e[0].style.display="block"),r.addClass(o))})}},form:{submit_wait_block:null,submit:function(e){var t={cache:!1,type:"POST",url:"Provider",data:$(e).serialize(),beforeSend:function(){nbApp.form.submit_wait_block.show()},complete:function(){nbApp.form.submit_wait_block.hide()},success:function(e){var t=nbApp.parseMessageToJson(e);"ok"===t.response.status?t.response.redirect&&(window.location.href=t.response.redirect):nbApp.ui.notify(t.response.message.text)},error:function(e,t){nbApp.ui.notify({msg:t,type:"error"}),nbApp.form.submit_wait_block.hide()}};return $.ajax(t)}},view:{},ui:{init:function(){var e="<div class='form_submit_wait_block' style='display:none;'><div class='form_submit_wait_block_inner'>Сохранение...</div></div>";nbApp.form.submit_wait_block=$(e),$("body").append(nbApp.form.submit_wait_block),nbApp.ui.notify_block=$("<div class='ct_app_ui_notify_block' style='display:none;'></div>"),$("body").append(nbApp.ui.notify_block)},notify_block:null,notify:function(e){var t;"string"==typeof e?(t={timeout:1700,type:""},t.msg=e):(t=e,t.timeout=e.timeout||1700,t.type="ct_app_ui_notify_"+e.type);var n=$("<div class='ct_app_ui_notify_block_inner "+t.type+"'>"+t.msg+"</div>");nbApp.ui.notify_block.append(n).show(),n.on("click",function(){n.remove(),t.callback&&t.callback()}),t.timeout>-1&&setTimeout(function(){n&&n.length&&n.fadeOut({always:function(){n.remove(),""===nbApp.ui.notify_block.text()&&nbApp.ui.notify_block.fadeOut().html(""),t.callback&&t.callback()}})},t.timeout)}}};$(document).ready(function(){nbApp.init();var e=$(".action-bar-dynamic");if(e.length){var t=$("<div class='action-target-count'></div>");$(".action-bar-container",e).prepend(t),$("[type=checkbox]",".view").click(function(){var e=$(".view [type=checkbox]:checked").length;
e>0?(t.html(e),$(".action-bar-dynamic").addClass("active")):(t.html(""),$(".action-bar-dynamic").removeClass("active"))})}$("[type=checkbox]",".view").click(function(){var e=$(this);if(!e.hasClass("getSaldoOnDate")){e.addClass("getSaldoOnDate");var t=e.val();nbApp.getSaldoOnDate(t).then(function(t){e.parents(".vt-row").children(".doclink").append("<div class='vt-saldo'>"+t+"</div>")})}}),$("form[name!='search']").submit(function(e){e.preventDefault(),nbApp.form.submit("form[name!='search']")})});var nbStrings={RUS:{document_not_selected:"Не выбран документ(ы)",document_mark_as_read:"Документ отмечен как прочтенный",delete_error:"Ошибка удаления",successfully_deleted:"Удаление завершено успешно",deleted:"Удалено",undeleted:"Не удалено"}};nbApp.deleteDocument=function(e){return nb.ajax({type:"POST",datatype:"XML",url:"Provider?type=page&id=delete_document&nocache="+300*Math.random(),data:e})},nbApp.getSaldoOnDate=function(e){return nb.ajax({method:"GET",url:"Provider?type=page&id=saldo_on_date&ddbid="+e})},$(function(){"use strict";$("#progress").css("display","none"),"undefined"!=typeof $.fn.fileupload&&$("#fileupload").fileupload({url:"Uploader",dataType:"xml",send:function(){$("#progress").css("display","block")},done:function(e,t){var n=nbApp.parseMessageToJson(t.result),o=$("#template-rtfcontent-entry").children().clone();if(!n.message)return $(".progress-bar",$("#progress").css("display","none")[0]).css("width","0%"),void alert("file upload error");var r=n.message[0].toString(),i=n.message[1].toString(),a=n.message[3].text,s="Provider?type=getattach&formsesid="+a;s+="&field=rtfcontent&id=rtfcontent&file="+r,$(o).appendTo("#attach-files"),$(o).append('<input type="hidden" name="filename" value="'+r+'"/>'),$(o).append('<input type="hidden" name="fileid" value="'+a+'"/>'),$(o).append('<input type="hidden" name="filehash" value="'+i+'"/>'),$("a.rtf-file",o).attr({href:s,target:"_blank"}).text(r),$("[data-click=add_comment]",o).on("click",function(){nbApp.attach.addComment(this,i)}),$("[data-click=remove]",o).on("click",function(){nbApp.attach.remove(this,a,r,i,!0)}),setTimeout(function(){$(".progress-bar",$("#progress").css("display","none")[0]).css("width","0%")},1e3)},progressall:function(e,t){var n=parseInt(t.loaded/t.total*100,10);$("#progress .progress-bar").css("width",n+"%").text(n+"%")},fail:function(){$(".progress-bar",$("#progress").css("display","none")[0]).css("width","0%"),alert("file upload fail")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")}),nbApp.attach={},nbApp.attach.preview=function(e){var t=$(e).parents(".rtf-entry"),n=$(t).find("a.rtf-file").append('<i class="rtf-loading"></i><br/>');$('<img class="attach-preview" style="display:none;">').attr("src",n.attr("href")).on("load",function(){$(this).show(),$("i.rtf-loading",n).remove()}).on("error",function(){alert("load error"),$("i.rtf-loading",n).remove(),$(this).remove()}).appendTo(t),$(e).hide()},nbApp.attach.addComment=function(e,t){var n=$(e).parents(".rtf-entry"),o=nb.dialog.show({message:$('<div><textarea rows="3"></textarea></div>').html(),title:"Коментарий",dialogClass:"nextbase-dialog-responsive",position:"top",buttons:{Ok:{text:"Ok",click:function(){var r=$("textarea",o).val();return 0===r.length?!1:($("#frm").append('<input type="hidden" name="comment'+t+'" value="'+r+'">'),$(n).find("a.rtf-file").after($('<span class="rtf-comment">').html(r)),$(e).hide(),void o.dialog("close"))}},Cancel:{text:"Oтмена",click:function(){o.dialog("close")}}}})},nbApp.attach.remove=function(e,t,n,o,r){r===!0?$(e).parents(".rtf-entry").remove():$(e).parents(".rtf-entry").addClass("to-delete"),$("#"+o).remove(),$("#frm").append('<input type="hidden" name="deletertfcontentsesid" value="'+t+'" />'),$("#frm").append('<input type="hidden" name="deletertfcontentname" value="'+n+'" />'),$("#frm").append('<input type="hidden" name="deletertfcontentfield" value="rtfcontent" />')},nbApp.dialogChoiceCategory=function(e){var t=nb.dialog.show({targetForm:e.form.name,fieldName:"category",title:e.title,dialogClass:"nextbase-dialog-responsive",draggable:!1,filter:!1,resizable:!1,width:500,height:$(window).height(),href:"Provider?type=page&id=picklist-category&page=1",onExecute:function(){if(nb.form.setValues(t,null)){var e,n,o,r=$("[data-type='select']:checked",t[0]);if($(r[0]).hasClass("js-response")){var i=$(r[0]).parents(".js-parent"),a=i.children("label:first"),s=a.text();$("#categorytbl").html(s+" / "+$("#categorytbl").text()),e=$("[name='viewtext3']",a).val(),n="1"==$("[name='viewtext5']",a).val(),o="1"==$("[name='viewtext6']",a).val()}else e=$("[data-id="+r[0].value+"][name='viewtext3']").val(),n="1"==$("[data-id="+r[0].value+"][name='viewtext5']").val(),o="1"==$("[data-id="+r[0].value+"][name='viewtext6']").val();"in"==e||"out"==e?($("input[name=targetcash]").val(""),$("#targetcashtbl").html(""),$("#control-row-targetcash").hide()):"transfer"==e?($("#control-row-targetcash").show(),$("input[name=costcenter]").val(""),$("#costcentertbl").html("")):"calcstuff"==e?($("#control-row-targetcash").show(),$("input[name=costcenter]").val(""),$("#costcentertbl").html("")):"getcash"==e&&(o=!0),n?($("[name=documented]").attr("required","required").attr("checked",!0),$("[name=documented]").attr("onclick","return false"),$("[name=documented]").attr("onkeydown","return false")):($("[name=documented]").removeAttr("required").removeAttr("disabled"),$("[name=documented]").attr("onclick",null),$("[name=documented]").attr("onkeydown",null)),o?$("[name=costcenter]").attr("required","required"):$("[name=costcenter]").removeAttr("required").removeAttr("disabled"),$("#subcategorytbl").html(""),$("#typeoperationtbl").attr("class","operation-type-icon-"+e).attr("title",e),$("input[name=subcategory]").val(""),t.dialog("close")}},buttons:{ok:{text:nb.strings.select,click:function(){t[0].dialogOptions.onExecute()}},cancel:{text:nb.strings.cancel,click:function(){t.dialog("close")}}},open:function(e){makeResponsiveDialog(e),Modernizr.touch&&$(".form-wrapper").addClass("hidden")},close:function(){Modernizr.touch&&$(".form-wrapper").removeClass("hidden"),$("input[name=summa]").focus()}})},nbApp.dialogChoiceTargetCash=function(e){var t=nb.dialog.show({targetForm:e.form.name,fieldName:"targetcash",title:e.title,dialogClass:"nextbase-dialog-responsive",draggable:!1,filter:!1,resizable:!1,width:500,height:$(window).height(),href:"Provider?type=page&id=picklist-cash&page=1",buttons:{ok:{text:nb.strings.select,click:function(){t[0].dialogOptions.onExecute()}},cancel:{text:nb.strings.cancel,click:function(){t.dialog("close")}}},open:function(e){makeResponsiveDialog(e),Modernizr.touch&&$(".form-wrapper").addClass("hidden")},close:function(){Modernizr.touch&&$(".form-wrapper").removeClass("hidden"),$("input[name=summa]").focus()}})},nbApp.dialogChoiceCostCenter=function(e){var t=nb.dialog.show({targetForm:e.form.name,fieldName:"costcenter",title:e.title,dialogClass:"nextbase-dialog-responsive",draggable:!1,filter:!1,resizable:!1,width:500,height:$(window).height(),href:"Provider?type=page&id=picklist-costcenter&page=1",buttons:{ok:{text:nb.strings.select,click:function(){t[0].dialogOptions.onExecute()}},cancel:{text:nb.strings.cancel,click:function(){t.dialog("close")}}},open:function(e){makeResponsiveDialog(e),Modernizr.touch&&$(".form-wrapper").addClass("hidden")},close:function(){Modernizr.touch&&$(".form-wrapper").removeClass("hidden"),$("[name=basis]").focus()}})},nbApp.dialogChoiceAccessRoles=function(e){var t=nb.dialog.show({targetForm:e.form.name,fieldName:"accessroles",title:e.title,dialogClass:"nextbase-dialog-responsive",draggable:!1,filter:!1,resizable:!1,width:500,height:$(window).height(),href:"Provider?type=view&id=picklist-roles&page=1",buttons:{ok:{text:nb.strings.select,click:function(){t[0].dialogOptions.onExecute()}},cancel:{text:nb.strings.cancel,click:function(){t.dialog("close")}}}})};